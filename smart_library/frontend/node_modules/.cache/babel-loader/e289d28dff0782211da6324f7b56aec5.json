{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u5565\\u90FD\\u884C\\\\\\u667A\\u6167\\u56FE\\u4E66\\u9986\\\\smart_library\\\\frontend\\\\src\\\\components\\\\ThreeScene.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { fadeTransition } from '../threejs/fadeTransition';\nimport { saveAs } from 'file-saver';\nimport * as TWEEN from '@tweenjs/tween.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WS_URL = 'ws://localhost:8080';\nconst ROWS = 5;\nconst COLS = 10;\nconst SEAT_SIZE = 0.4;\nconst SEAT_GAP = 0.6;\nconst TABLE_WIDTH = COLS * SEAT_GAP;\nconst TABLE_DEPTH = 0.5;\nconst ROOM_WIDTH = COLS * SEAT_GAP + 2;\nconst ROOM_DEPTH = ROWS * 2 + 2;\nconst ROOM_HEIGHT = 3;\n\n// 书架配置\nconst BOOKSHELF_CONFIG = {\n  width: 1.2,\n  depth: 0.4,\n  height: 2.2,\n  gap: 0.8,\n  rows: 2,\n  cols: 4\n};\n\n// 讲台/服务台配置\nconst COUNTER_CONFIG = {\n  width: 3,\n  depth: 0.8,\n  height: 1.1\n};\nconst STATUS_COLOR = {\n  available: '#00ff00',\n  // 绿色\n  occupied: '#ff0000',\n  // 红色\n  reserved: '#ffd600',\n  // 黄色\n  broken: '#888888' // 灰色\n};\n\n// 预设视角配置\nconst CAMERA_PRESETS = {\n  top: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT * 2, 0),\n    lookAt: new THREE.Vector3(0, 0, 0)\n  },\n  front: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT / 2, ROOM_DEPTH * 1.5),\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT / 2, 0)\n  },\n  side: {\n    position: new THREE.Vector3(ROOM_WIDTH * 1.5, ROOM_HEIGHT / 2, 0),\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT / 2, 0)\n  },\n  default: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT, ROOM_DEPTH / 2 + 2),\n    lookAt: new THREE.Vector3(0, 0, 0)\n  }\n};\n\n// 在 useEffect 外部添加以下函数，确保全局可用\nfunction onWindowResize() {\n  // 这里假设 camera 和 renderer 是全局变量或通过 ref 获取\n  // 你可以根据实际情况调整\n  if (window.camera && window.renderer) {\n    window.camera.aspect = window.innerWidth / window.innerHeight;\n    window.camera.updateProjectionMatrix();\n    window.renderer.setSize(window.innerWidth, window.innerHeight);\n  }\n}\nexport default function ThreeScene() {\n  _s();\n  const mountRef = useRef();\n  const seatMeshMap = useRef({});\n  const sceneRef = useRef();\n  const cameraRef = useRef();\n  const transitionRef = useRef();\n  const [selectedObject, setSelectedObject] = useState(null);\n  const [hoveredObject, setHoveredObject] = useState(null);\n  const [cameraMode, setCameraMode] = useState('orbit');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [showMiniMap, setShowMiniMap] = useState(true);\n  const [sceneState, setSceneState] = useState(null);\n\n  // animateCamera 提升到组件作用域\n  function animateCamera(targetPosition, targetLookAt, duration = 1000) {\n    const camera = cameraRef.current;\n    if (!camera) return;\n    const startPosition = camera.position.clone();\n    const startLookAt = new THREE.Vector3();\n    camera.getWorldDirection(startLookAt);\n    startLookAt.multiplyScalar(10).add(camera.position);\n    const startTime = Date.now();\n    function updateCamera() {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const easeProgress = 1 - Math.pow(1 - progress, 3);\n      camera.position.lerpVectors(startPosition, targetPosition, easeProgress);\n      const currentLookAt = new THREE.Vector3();\n      currentLookAt.lerpVectors(startLookAt, targetLookAt, easeProgress);\n      camera.lookAt(currentLookAt);\n      if (progress < 1) {\n        requestAnimationFrame(updateCamera);\n      }\n    }\n    updateCamera();\n  }\n\n  // saveSceneState 提升到组件作用域\n  function saveSceneState() {\n    const camera = cameraRef.current;\n    const scene = sceneRef.current;\n    if (!camera || !scene) return;\n    const state = {\n      camera: {\n        position: camera.position.toArray(),\n        lookAt: new THREE.Vector3().subVectors(camera.position, new THREE.Vector3().setFromMatrixColumn(camera.matrix, 2)).toArray()\n      },\n      objects: scene.children.filter(obj => obj.userData && obj.userData.type).map(obj => ({\n        id: obj.userData.id,\n        type: obj.userData.type,\n        position: obj.position.toArray(),\n        rotation: obj.rotation.toArray(),\n        scale: obj.scale.toArray(),\n        status: obj.userData.status,\n        info: obj.userData.info\n      }))\n    };\n    const blob = new Blob([JSON.stringify(state, null, 2)], {\n      type: 'application/json'\n    });\n    saveAs(blob, 'library-scene.json');\n  }\n\n  // loadSceneState 提升到组件作用域\n  function loadSceneState(event) {\n    const camera = cameraRef.current;\n    const scene = sceneRef.current;\n    if (!camera || !scene) return;\n    const file = event.target.files[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = e => {\n        try {\n          const state = JSON.parse(e.target.result);\n          if (state.camera) {\n            const {\n              position,\n              lookAt\n            } = state.camera;\n            animateCamera(new THREE.Vector3(...position), new THREE.Vector3(...lookAt));\n          }\n          state.objects.forEach(objState => {\n            const obj = scene.children.find(child => child.userData && child.userData.id === objState.id);\n            if (obj) {\n              obj.position.fromArray(objState.position);\n              obj.rotation.fromArray(objState.rotation);\n              obj.scale.fromArray(objState.scale);\n              obj.userData.status = objState.status;\n              obj.userData.info = objState.info;\n              if (obj.material && objState.status) {\n                obj.material.color.set(STATUS_COLOR[objState.status]);\n              }\n            }\n          });\n          setSceneState(state);\n        } catch (error) {\n          console.error('Error loading scene state:', error);\n          alert('加载场景状态失败');\n        }\n      };\n      reader.readAsText(file);\n    }\n  }\n  useEffect(() => {\n    // 场景、相机、渲染器\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0x22232a);\n    sceneRef.current = scene;\n    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);\n    camera.position.set(0, ROOM_HEIGHT, ROOM_DEPTH / 2 + 2);\n    camera.lookAt(0, 0, 0);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    mountRef.current.appendChild(renderer.domElement);\n    transitionRef.current = fadeTransition(renderer);\n\n    // 添加轨道控制器\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controls.screenSpacePanning = false;\n    controls.minDistance = 3;\n    controls.maxDistance = 20;\n    controls.maxPolarAngle = Math.PI / 2;\n\n    // 灯光\n    const ambient = new THREE.AmbientLight(0xffffff, 0.4);\n    scene.add(ambient);\n    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);\n    dirLight.position.set(5, 10, 5);\n    dirLight.castShadow = true;\n    dirLight.shadow.mapSize.width = 2048;\n    dirLight.shadow.mapSize.height = 2048;\n    dirLight.shadow.camera.near = 0.5;\n    dirLight.shadow.camera.far = 50;\n    dirLight.shadow.camera.left = -10;\n    dirLight.shadow.camera.right = 10;\n    dirLight.shadow.camera.top = 10;\n    dirLight.shadow.camera.bottom = -10;\n    scene.add(dirLight);\n\n    // 为所有物体启用阴影\n    scene.traverse(object => {\n      if (object.isMesh) {\n        object.castShadow = true;\n        object.receiveShadow = true;\n      }\n    });\n\n    // 地板\n    const floorGeo = new THREE.BoxGeometry(ROOM_WIDTH, 0.1, ROOM_DEPTH);\n    const floorMat = new THREE.MeshPhongMaterial({\n      color: 0xcccccc\n    });\n    const floor = new THREE.Mesh(floorGeo, floorMat);\n    floor.position.set(0, -0.05, 0);\n    scene.add(floor);\n\n    // 墙壁\n    const wallMat = new THREE.MeshPhongMaterial({\n      color: 0xeeeeee,\n      side: THREE.DoubleSide\n    });\n    // 后墙\n    const wallBack = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH, ROOM_HEIGHT, 0.1), wallMat);\n    wallBack.position.set(0, ROOM_HEIGHT / 2, -ROOM_DEPTH / 2);\n    scene.add(wallBack);\n    // 前墙（有门）\n    const wallFront = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH - 2, ROOM_HEIGHT, 0.1), wallMat);\n    wallFront.position.set(0, ROOM_HEIGHT / 2, ROOM_DEPTH / 2);\n    scene.add(wallFront);\n    // 左右墙（有窗）\n    const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\n    wallLeft.position.set(-ROOM_WIDTH / 2, ROOM_HEIGHT / 2, 0);\n    scene.add(wallLeft);\n    const wallRight = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\n    wallRight.position.set(ROOM_WIDTH / 2, ROOM_HEIGHT / 2, 0);\n    scene.add(wallRight);\n    // 门\n    const doorGeo = new THREE.BoxGeometry(1, 2, 0.12);\n    const doorMat = new THREE.MeshPhongMaterial({\n      color: 0x8d5524\n    });\n    const door = new THREE.Mesh(doorGeo, doorMat);\n    door.position.set(0, 1, ROOM_DEPTH / 2 + 0.06);\n    scene.add(door);\n    // 窗\n    const windowGeo = new THREE.BoxGeometry(0.1, 1, 2);\n    const windowMat = new THREE.MeshPhongMaterial({\n      color: 0x87ceeb,\n      transparent: true,\n      opacity: 0.5\n    });\n    const window1 = new THREE.Mesh(windowGeo, windowMat);\n    window1.position.set(-ROOM_WIDTH / 2 - 0.06, 2, 0);\n    scene.add(window1);\n    const window2 = new THREE.Mesh(windowGeo, windowMat);\n    window2.position.set(ROOM_WIDTH / 2 + 0.06, 2, 0);\n    scene.add(window2);\n\n    // 添加书架\n    const bookshelfMat = new THREE.MeshPhongMaterial({\n      color: 0x8B4513\n    });\n    for (let row = 0; row < BOOKSHELF_CONFIG.rows; row++) {\n      for (let col = 0; col < BOOKSHELF_CONFIG.cols; col++) {\n        const bookshelf = new THREE.Mesh(new THREE.BoxGeometry(BOOKSHELF_CONFIG.width, BOOKSHELF_CONFIG.height, BOOKSHELF_CONFIG.depth), bookshelfMat);\n        bookshelf.position.set((col - (BOOKSHELF_CONFIG.cols - 1) / 2) * (BOOKSHELF_CONFIG.width + BOOKSHELF_CONFIG.gap), BOOKSHELF_CONFIG.height / 2, -ROOM_DEPTH / 2 + 0.5 + row * (BOOKSHELF_CONFIG.depth + 0.3));\n        bookshelf.userData = {\n          type: 'bookshelf',\n          id: `bookshelf-${row + 1}-${col + 1}`,\n          info: {\n            name: `书架 ${row + 1}-${col + 1}`,\n            capacity: '约200本书',\n            category: '综合类'\n          }\n        };\n        scene.add(bookshelf);\n      }\n    }\n\n    // 添加讲台/服务台\n    const counterMat = new THREE.MeshPhongMaterial({\n      color: 0x4B0082\n    });\n    const counter = new THREE.Mesh(new THREE.BoxGeometry(COUNTER_CONFIG.width, COUNTER_CONFIG.height, COUNTER_CONFIG.depth), counterMat);\n    counter.position.set(0, COUNTER_CONFIG.height / 2, ROOM_DEPTH / 2 - 1);\n    counter.userData = {\n      type: 'counter',\n      id: 'service-counter',\n      info: {\n        name: '服务台',\n        description: '提供咨询、借还书等服务',\n        staff: '2名工作人员'\n      }\n    };\n    scene.add(counter);\n\n    // 桌椅和座位\n    for (let row = 0; row < ROWS; row++) {\n      // 桌子\n      const tableGeo = new THREE.BoxGeometry(TABLE_WIDTH, 0.1, TABLE_DEPTH);\n      const tableMat = new THREE.MeshPhongMaterial({\n        color: 0xf5deb3\n      });\n      const table = new THREE.Mesh(tableGeo, tableMat);\n      table.position.set(0, 0.5, (row - (ROWS - 1) / 2) * 2);\n      scene.add(table);\n      // 座位\n      for (let col = 0; col < COLS; col++) {\n        // 椅子\n        const chairGeo = new THREE.CylinderGeometry(SEAT_SIZE / 2, SEAT_SIZE / 2, 0.18, 16);\n        const chairMat = new THREE.MeshPhongMaterial({\n          color: 0x444444\n        });\n        const chair = new THREE.Mesh(chairGeo, chairMat);\n        chair.position.set((col - (COLS - 1) / 2) * SEAT_GAP, 0.09, (row - (ROWS - 1) / 2) * 2 - TABLE_DEPTH / 2 - 0.3);\n        scene.add(chair);\n        // 座位（可变色）\n        const seatGeo = new THREE.SphereGeometry(SEAT_SIZE / 2, 16, 16);\n        const seatMat = new THREE.MeshPhongMaterial({\n          color: STATUS_COLOR.available\n        });\n        const seat = new THREE.Mesh(seatGeo, seatMat);\n        seat.position.set((col - (COLS - 1) / 2) * SEAT_GAP, 0.25, (row - (ROWS - 1) / 2) * 2 - TABLE_DEPTH / 2 - 0.3);\n        seat.userData = {\n          type: 'seat',\n          id: `seat-${row + 1}-${col + 1}`,\n          status: 'available',\n          info: {\n            name: `座位 ${row + 1}-${col + 1}`,\n            type: '普通座位',\n            hasPower: true,\n            hasComputer: false\n          }\n        };\n        scene.add(seat);\n        seatMeshMap.current[seat.userData.id] = seat;\n      }\n    }\n\n    // 添加场景标签\n    const labelDiv = document.createElement('div');\n    labelDiv.style.position = 'absolute';\n    labelDiv.style.pointerEvents = 'none';\n    labelDiv.style.color = 'white';\n    labelDiv.style.fontSize = '14px';\n    labelDiv.style.fontFamily = 'Arial';\n    labelDiv.style.textShadow = '1px 1px 1px black';\n    mountRef.current.appendChild(labelDiv);\n\n    // 创建标签位置映射\n    const labelPositions = new Map();\n    function updateLabelPosition(object, label) {\n      const vector = object.position.clone();\n      vector.project(camera);\n      const x = (vector.x * 0.5 + 0.5) * window.innerWidth;\n      const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;\n      label.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;\n    }\n\n    // 为每个物体添加标签\n    function addLabel(object) {\n      if (object.userData && object.userData.info) {\n        const label = document.createElement('div');\n        label.textContent = object.userData.info.name;\n        label.style.opacity = '0';\n        label.style.transition = 'opacity 0.3s';\n        labelDiv.appendChild(label);\n        labelPositions.set(object, label);\n      }\n    }\n\n    // 交互：鼠标悬停和点击\n    const raycaster = new THREE.Raycaster();\n    const mouse = new THREE.Vector2();\n    const originalMaterials = new Map();\n    function onMouseMove(event) {\n      // 计算鼠标在归一化设备坐标中的位置\n      mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n      // 更新射线\n      raycaster.setFromCamera(mouse, camera);\n\n      // 获取射线与物体的交点\n      const intersects = raycaster.intersectObjects(scene.children);\n\n      // 重置之前高亮的物体\n      if (hoveredObject) {\n        const originalMaterial = originalMaterials.get(hoveredObject);\n        if (originalMaterial) {\n          hoveredObject.material = originalMaterial;\n        }\n        setHoveredObject(null);\n      }\n\n      // 高亮当前悬停的物体\n      if (intersects.length > 0) {\n        const object = intersects[0].object;\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\n          if (!originalMaterials.has(object)) {\n            originalMaterials.set(object, object.material.clone());\n          }\n          const highlightMaterial = object.material.clone();\n          highlightMaterial.emissive = new THREE.Color(0x666666);\n          object.material = highlightMaterial;\n          setHoveredObject(object);\n        }\n      }\n    }\n    function onClick(event) {\n      // 计算鼠标在归一化设备坐标中的位置\n      mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n      // 更新射线\n      raycaster.setFromCamera(mouse, camera);\n\n      // 获取射线与物体的交点\n      const intersects = raycaster.intersectObjects(scene.children);\n      if (intersects.length > 0) {\n        const object = intersects[0].object;\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\n          setSelectedObject(object.userData);\n        }\n      } else {\n        setSelectedObject(null);\n      }\n    }\n\n    // 添加事件监听器\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('click', onClick);\n\n    // 更新标签可见性\n    function updateLabels() {\n      labelPositions.forEach((label, object) => {\n        const vector = object.position.clone();\n        vector.project(camera);\n        if (vector.z < 1) {\n          updateLabelPosition(object, label);\n          label.style.opacity = '1';\n        } else {\n          label.style.opacity = '0';\n        }\n      });\n    }\n\n    // 添加动画效果\n    function animateObjects() {\n      scene.children.forEach(object => {\n        if (object.userData && object.userData.type) {\n          // 添加轻微的浮动动画\n          object.position.y += Math.sin(Date.now() * 0.001 + object.position.x) * 0.0001;\n        }\n      });\n    }\n\n    // 添加阴影\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\n    // 创建小地图\n    const miniMapCamera = new THREE.OrthographicCamera(-ROOM_WIDTH / 2, ROOM_WIDTH / 2, ROOM_DEPTH / 2, -ROOM_DEPTH / 2, 0.1, 1000);\n    miniMapCamera.position.set(0, ROOM_HEIGHT * 2, 0);\n    miniMapCamera.lookAt(0, 0, 0);\n    const miniMapRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    miniMapRenderer.setSize(200, 200);\n    miniMapRenderer.shadowMap.enabled = true;\n    miniMapRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n    const miniMapDiv = document.createElement('div');\n    miniMapDiv.style.position = 'absolute';\n    miniMapDiv.style.bottom = '20px';\n    miniMapDiv.style.right = '20px';\n    miniMapDiv.style.width = '200px';\n    miniMapDiv.style.height = '200px';\n    miniMapDiv.style.border = '2px solid white';\n    miniMapDiv.style.borderRadius = '4px';\n    miniMapDiv.style.overflow = 'hidden';\n    miniMapDiv.appendChild(miniMapRenderer.domElement);\n    mountRef.current.appendChild(miniMapDiv);\n\n    // 相机动画\n    function animate() {\n      requestAnimationFrame(animate);\n      controls.update();\n      animateObjects();\n      updateLabels();\n      renderer.render(scene, camera);\n\n      // 更新小地图\n      if (showMiniMap) {\n        miniMapRenderer.render(scene, miniMapCamera);\n      }\n    }\n    animate();\n\n    // 添加物体状态变化动画\n    function animateObjectState(object, newState) {\n      if (!object.userData) return;\n      const originalScale = object.scale.clone();\n      const targetScale = originalScale.clone().multiplyScalar(1.2);\n\n      // 缩放动画\n      const scaleAnimation = new TWEEN.Tween(object.scale).to({\n        x: targetScale.x,\n        y: targetScale.y,\n        z: targetScale.z\n      }, 200).easing(TWEEN.Easing.Quadratic.Out).yoyo(true).repeat(1);\n\n      // 颜色变化动画\n      if (object.material) {\n        const originalColor = object.material.color.clone();\n        const targetColor = new THREE.Color(STATUS_COLOR[newState] || '#ffffff');\n        const colorAnimation = new TWEEN.Tween(object.material.color).to({\n          r: targetColor.r,\n          g: targetColor.g,\n          b: targetColor.b\n        }, 400).easing(TWEEN.Easing.Quadratic.InOut);\n        colorAnimation.start();\n      }\n      scaleAnimation.start();\n    }\n    cameraRef.current = camera;\n\n    // 修改清理函数\n    return () => {\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('click', onClick);\n      window.removeEventListener('resize', onWindowResize);\n      mountRef.current.removeChild(renderer.domElement);\n      mountRef.current.removeChild(labelDiv);\n      mountRef.current.removeChild(miniMapDiv);\n      controls.dispose();\n    };\n  }, []);\n\n  // 处理视角切换\n  const handleViewChange = view => {\n    const preset = CAMERA_PRESETS[view];\n    if (preset) {\n      animateCamera(preset.position, preset.lookAt);\n    }\n  };\n\n  // 处理搜索\n  const handleSearch = query => {\n    setSearchQuery(query);\n    // 实现搜索逻辑\n  };\n\n  // 处理分类筛选\n  const handleCategoryChange = category => {\n    setSelectedCategory(category);\n    // 实现分类筛选逻辑\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mountRef,\n      style: {\n        width: '100%',\n        height: '100vh'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 590,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '20px',\n        right: '20px',\n        background: 'rgba(255, 255, 255, 0.9)',\n        padding: '20px',\n        borderRadius: '8px',\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '10px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: '0 0 10px 0'\n          },\n          children: \"\\u89C6\\u89D2\\u63A7\\u5236\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '5px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('top'),\n            children: \"\\u4FEF\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('front'),\n            children: \"\\u524D\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('side'),\n            children: \"\\u4FA7\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 611,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('default'),\n            children: \"\\u9ED8\\u8BA4\\u89C6\\u89D2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 608,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"\\u641C\\u7D22...\",\n          value: searchQuery,\n          onChange: e => handleSearch(e.target.value),\n          style: {\n            padding: '8px',\n            borderRadius: '4px',\n            border: '1px solid #ccc',\n            width: '100%'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 618,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 617,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedCategory,\n          onChange: e => handleCategoryChange(e.target.value),\n          style: {\n            padding: '8px',\n            borderRadius: '4px',\n            border: '1px solid #ccc',\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"all\",\n            children: \"\\u6240\\u6709\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 644,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"seat\",\n            children: \"\\u5EA7\\u4F4D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 645,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"bookshelf\",\n            children: \"\\u4E66\\u67B6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 646,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"counter\",\n            children: \"\\u670D\\u52A1\\u53F0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 647,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 634,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 633,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"label\", {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            checked: showMiniMap,\n            onChange: e => setShowMiniMap(e.target.checked)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 654,\n            columnNumber: 13\n          }, this), \"\\u663E\\u793A\\u5C0F\\u5730\\u56FE\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 652,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setCameraMode(mode => mode === 'orbit' ? 'fixed' : 'orbit'),\n        style: {\n          padding: '8px 16px',\n          border: 'none',\n          borderRadius: '4px',\n          background: '#4CAF50',\n          color: 'white',\n          cursor: 'pointer'\n        },\n        children: cameraMode === 'orbit' ? '固定视角' : '自由视角'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 664,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '10px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: saveSceneState,\n          style: {\n            padding: '8px 16px',\n            border: 'none',\n            borderRadius: '4px',\n            background: '#2196F3',\n            color: 'white',\n            cursor: 'pointer',\n            flex: 1\n          },\n          children: \"\\u4FDD\\u5B58\\u573A\\u666F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            padding: '8px 16px',\n            border: 'none',\n            borderRadius: '4px',\n            background: '#FF9800',\n            color: 'white',\n            cursor: 'pointer',\n            textAlign: 'center',\n            flex: 1\n          },\n          children: [\"\\u52A0\\u8F7D\\u573A\\u666F\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \".json\",\n            onChange: loadSceneState,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 694,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 679,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 593,\n      columnNumber: 7\n    }, this), selectedObject && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '20px',\n        left: '20px',\n        background: 'rgba(255, 255, 255, 0.9)',\n        padding: '20px',\n        borderRadius: '8px',\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\n        maxWidth: '300px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: selectedObject.info.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 729,\n        columnNumber: 11\n      }, this), Object.entries(selectedObject.info).map(([key, value]) => key !== 'name' && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [key, \": \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 17\n        }, this), value]\n      }, key, true, {\n        fileName: _jsxFileName,\n        lineNumber: 732,\n        columnNumber: 15\n      }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setSelectedObject(null),\n        style: {\n          position: 'absolute',\n          top: '10px',\n          right: '10px',\n          background: 'none',\n          border: 'none',\n          fontSize: '20px',\n          cursor: 'pointer'\n        },\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 738,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 719,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 589,\n    columnNumber: 5\n  }, this);\n}\n_s(ThreeScene, \"IfeNZoIY2t6fDjkifryz1wjaFFo=\");\n_c = ThreeScene;\nvar _c;\n$RefreshReg$(_c, \"ThreeScene\");","map":{"version":3,"names":["React","useEffect","useRef","useState","THREE","OrbitControls","fadeTransition","saveAs","TWEEN","jsxDEV","_jsxDEV","WS_URL","ROWS","COLS","SEAT_SIZE","SEAT_GAP","TABLE_WIDTH","TABLE_DEPTH","ROOM_WIDTH","ROOM_DEPTH","ROOM_HEIGHT","BOOKSHELF_CONFIG","width","depth","height","gap","rows","cols","COUNTER_CONFIG","STATUS_COLOR","available","occupied","reserved","broken","CAMERA_PRESETS","top","position","Vector3","lookAt","front","side","default","onWindowResize","window","camera","renderer","aspect","innerWidth","innerHeight","updateProjectionMatrix","setSize","ThreeScene","_s","mountRef","seatMeshMap","sceneRef","cameraRef","transitionRef","selectedObject","setSelectedObject","hoveredObject","setHoveredObject","cameraMode","setCameraMode","searchQuery","setSearchQuery","selectedCategory","setSelectedCategory","showMiniMap","setShowMiniMap","sceneState","setSceneState","animateCamera","targetPosition","targetLookAt","duration","current","startPosition","clone","startLookAt","getWorldDirection","multiplyScalar","add","startTime","Date","now","updateCamera","elapsed","progress","Math","min","easeProgress","pow","lerpVectors","currentLookAt","requestAnimationFrame","saveSceneState","scene","state","toArray","subVectors","setFromMatrixColumn","matrix","objects","children","filter","obj","userData","type","map","id","rotation","scale","status","info","blob","Blob","JSON","stringify","loadSceneState","event","file","target","files","reader","FileReader","onload","e","parse","result","forEach","objState","find","child","fromArray","material","color","set","error","console","alert","readAsText","Scene","background","Color","PerspectiveCamera","WebGLRenderer","antialias","appendChild","domElement","controls","enableDamping","dampingFactor","screenSpacePanning","minDistance","maxDistance","maxPolarAngle","PI","ambient","AmbientLight","dirLight","DirectionalLight","castShadow","shadow","mapSize","near","far","left","right","bottom","traverse","object","isMesh","receiveShadow","floorGeo","BoxGeometry","floorMat","MeshPhongMaterial","floor","Mesh","wallMat","DoubleSide","wallBack","wallFront","wallLeft","wallRight","doorGeo","doorMat","door","windowGeo","windowMat","transparent","opacity","window1","window2","bookshelfMat","row","col","bookshelf","name","capacity","category","counterMat","counter","description","staff","tableGeo","tableMat","table","chairGeo","CylinderGeometry","chairMat","chair","seatGeo","SphereGeometry","seatMat","seat","hasPower","hasComputer","labelDiv","document","createElement","style","pointerEvents","fontSize","fontFamily","textShadow","labelPositions","Map","updateLabelPosition","label","vector","project","x","y","transform","addLabel","textContent","transition","raycaster","Raycaster","mouse","Vector2","originalMaterials","onMouseMove","clientX","clientY","setFromCamera","intersects","intersectObjects","originalMaterial","get","length","has","highlightMaterial","emissive","onClick","addEventListener","updateLabels","z","animateObjects","sin","shadowMap","enabled","PCFSoftShadowMap","miniMapCamera","OrthographicCamera","miniMapRenderer","miniMapDiv","border","borderRadius","overflow","animate","update","render","animateObjectState","newState","originalScale","targetScale","scaleAnimation","Tween","to","easing","Easing","Quadratic","Out","yoyo","repeat","originalColor","targetColor","colorAnimation","r","g","b","InOut","start","removeEventListener","removeChild","dispose","handleViewChange","view","preset","handleSearch","query","handleCategoryChange","ref","fileName","_jsxFileName","lineNumber","columnNumber","padding","boxShadow","display","flexDirection","margin","placeholder","value","onChange","checked","mode","cursor","flex","textAlign","accept","maxWidth","Object","entries","key","_c","$RefreshReg$"],"sources":["D:/啥都行/智慧图书馆/smart_library/frontend/src/components/ThreeScene.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { fadeTransition } from '../threejs/fadeTransition';\r\nimport { saveAs } from 'file-saver';\r\nimport * as TWEEN from '@tweenjs/tween.js';\r\n\r\nconst WS_URL = 'ws://localhost:8080';\r\nconst ROWS = 5;\r\nconst COLS = 10;\r\nconst SEAT_SIZE = 0.4;\r\nconst SEAT_GAP = 0.6;\r\nconst TABLE_WIDTH = COLS * SEAT_GAP;\r\nconst TABLE_DEPTH = 0.5;\r\nconst ROOM_WIDTH = COLS * SEAT_GAP + 2;\r\nconst ROOM_DEPTH = ROWS * 2 + 2;\r\nconst ROOM_HEIGHT = 3;\r\n\r\n// 书架配置\r\nconst BOOKSHELF_CONFIG = {\r\n  width: 1.2,\r\n  depth: 0.4,\r\n  height: 2.2,\r\n  gap: 0.8,\r\n  rows: 2,\r\n  cols: 4\r\n};\r\n\r\n// 讲台/服务台配置\r\nconst COUNTER_CONFIG = {\r\n  width: 3,\r\n  depth: 0.8,\r\n  height: 1.1\r\n};\r\n\r\nconst STATUS_COLOR = {\r\n  available: '#00ff00', // 绿色\r\n  occupied: '#ff0000', // 红色\r\n  reserved: '#ffd600', // 黄色\r\n  broken: '#888888'    // 灰色\r\n};\r\n\r\n// 预设视角配置\r\nconst CAMERA_PRESETS = {\r\n  top: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT * 2, 0),\r\n    lookAt: new THREE.Vector3(0, 0, 0)\r\n  },\r\n  front: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT/2, ROOM_DEPTH * 1.5),\r\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT/2, 0)\r\n  },\r\n  side: {\r\n    position: new THREE.Vector3(ROOM_WIDTH * 1.5, ROOM_HEIGHT/2, 0),\r\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT/2, 0)\r\n  },\r\n  default: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT, ROOM_DEPTH/2 + 2),\r\n    lookAt: new THREE.Vector3(0, 0, 0)\r\n  }\r\n};\r\n\r\n// 在 useEffect 外部添加以下函数，确保全局可用\r\nfunction onWindowResize() {\r\n  // 这里假设 camera 和 renderer 是全局变量或通过 ref 获取\r\n  // 你可以根据实际情况调整\r\n  if (window.camera && window.renderer) {\r\n    window.camera.aspect = window.innerWidth / window.innerHeight;\r\n    window.camera.updateProjectionMatrix();\r\n    window.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n}\r\n\r\nexport default function ThreeScene() {\r\n  const mountRef = useRef();\r\n  const seatMeshMap = useRef({});\r\n  const sceneRef = useRef();\r\n  const cameraRef = useRef();\r\n  const transitionRef = useRef();\r\n  const [selectedObject, setSelectedObject] = useState(null);\r\n  const [hoveredObject, setHoveredObject] = useState(null);\r\n  const [cameraMode, setCameraMode] = useState('orbit');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState('all');\r\n  const [showMiniMap, setShowMiniMap] = useState(true);\r\n  const [sceneState, setSceneState] = useState(null);\r\n\r\n  // animateCamera 提升到组件作用域\r\n  function animateCamera(targetPosition, targetLookAt, duration = 1000) {\r\n    const camera = cameraRef.current;\r\n    if (!camera) return;\r\n    const startPosition = camera.position.clone();\r\n    const startLookAt = new THREE.Vector3();\r\n    camera.getWorldDirection(startLookAt);\r\n    startLookAt.multiplyScalar(10).add(camera.position);\r\n    const startTime = Date.now();\r\n    function updateCamera() {\r\n      const elapsed = Date.now() - startTime;\r\n      const progress = Math.min(elapsed / duration, 1);\r\n      const easeProgress = 1 - Math.pow(1 - progress, 3);\r\n      camera.position.lerpVectors(startPosition, targetPosition, easeProgress);\r\n      const currentLookAt = new THREE.Vector3();\r\n      currentLookAt.lerpVectors(startLookAt, targetLookAt, easeProgress);\r\n      camera.lookAt(currentLookAt);\r\n      if (progress < 1) {\r\n        requestAnimationFrame(updateCamera);\r\n      }\r\n    }\r\n    updateCamera();\r\n  }\r\n\r\n  // saveSceneState 提升到组件作用域\r\n  function saveSceneState() {\r\n    const camera = cameraRef.current;\r\n    const scene = sceneRef.current;\r\n    if (!camera || !scene) return;\r\n    const state = {\r\n      camera: {\r\n        position: camera.position.toArray(),\r\n        lookAt: new THREE.Vector3().subVectors(\r\n          camera.position,\r\n          new THREE.Vector3().setFromMatrixColumn(camera.matrix, 2)\r\n        ).toArray()\r\n      },\r\n      objects: scene.children\r\n        .filter(obj => obj.userData && obj.userData.type)\r\n        .map(obj => ({\r\n          id: obj.userData.id,\r\n          type: obj.userData.type,\r\n          position: obj.position.toArray(),\r\n          rotation: obj.rotation.toArray(),\r\n          scale: obj.scale.toArray(),\r\n          status: obj.userData.status,\r\n          info: obj.userData.info\r\n        }))\r\n    };\r\n    const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });\r\n    saveAs(blob, 'library-scene.json');\r\n  }\r\n\r\n  // loadSceneState 提升到组件作用域\r\n  function loadSceneState(event) {\r\n    const camera = cameraRef.current;\r\n    const scene = sceneRef.current;\r\n    if (!camera || !scene) return;\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        try {\r\n          const state = JSON.parse(e.target.result);\r\n          if (state.camera) {\r\n            const { position, lookAt } = state.camera;\r\n            animateCamera(\r\n              new THREE.Vector3(...position),\r\n              new THREE.Vector3(...lookAt)\r\n            );\r\n          }\r\n          state.objects.forEach(objState => {\r\n            const obj = scene.children.find(\r\n              child => child.userData && child.userData.id === objState.id\r\n            );\r\n            if (obj) {\r\n              obj.position.fromArray(objState.position);\r\n              obj.rotation.fromArray(objState.rotation);\r\n              obj.scale.fromArray(objState.scale);\r\n              obj.userData.status = objState.status;\r\n              obj.userData.info = objState.info;\r\n              if (obj.material && objState.status) {\r\n                obj.material.color.set(STATUS_COLOR[objState.status]);\r\n              }\r\n            }\r\n          });\r\n          setSceneState(state);\r\n        } catch (error) {\r\n          console.error('Error loading scene state:', error);\r\n          alert('加载场景状态失败');\r\n        }\r\n      };\r\n      reader.readAsText(file);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    // 场景、相机、渲染器\r\n    const scene = new THREE.Scene();\r\n    scene.background = new THREE.Color(0x22232a);\r\n    sceneRef.current = scene;\r\n    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);\r\n    camera.position.set(0, ROOM_HEIGHT, ROOM_DEPTH/2 + 2);\r\n    camera.lookAt(0, 0, 0);\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n    mountRef.current.appendChild(renderer.domElement);\r\n    transitionRef.current = fadeTransition(renderer);\r\n\r\n    // 添加轨道控制器\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.screenSpacePanning = false;\r\n    controls.minDistance = 3;\r\n    controls.maxDistance = 20;\r\n    controls.maxPolarAngle = Math.PI / 2;\r\n\r\n    // 灯光\r\n    const ambient = new THREE.AmbientLight(0xffffff, 0.4);\r\n    scene.add(ambient);\r\n    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);\r\n    dirLight.position.set(5, 10, 5);\r\n    dirLight.castShadow = true;\r\n    dirLight.shadow.mapSize.width = 2048;\r\n    dirLight.shadow.mapSize.height = 2048;\r\n    dirLight.shadow.camera.near = 0.5;\r\n    dirLight.shadow.camera.far = 50;\r\n    dirLight.shadow.camera.left = -10;\r\n    dirLight.shadow.camera.right = 10;\r\n    dirLight.shadow.camera.top = 10;\r\n    dirLight.shadow.camera.bottom = -10;\r\n    scene.add(dirLight);\r\n\r\n    // 为所有物体启用阴影\r\n    scene.traverse((object) => {\r\n      if (object.isMesh) {\r\n        object.castShadow = true;\r\n        object.receiveShadow = true;\r\n      }\r\n    });\r\n\r\n    // 地板\r\n    const floorGeo = new THREE.BoxGeometry(ROOM_WIDTH, 0.1, ROOM_DEPTH);\r\n    const floorMat = new THREE.MeshPhongMaterial({ color: 0xcccccc });\r\n    const floor = new THREE.Mesh(floorGeo, floorMat);\r\n    floor.position.set(0, -0.05, 0);\r\n    scene.add(floor);\r\n\r\n    // 墙壁\r\n    const wallMat = new THREE.MeshPhongMaterial({ color: 0xeeeeee, side: THREE.DoubleSide });\r\n    // 后墙\r\n    const wallBack = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH, ROOM_HEIGHT, 0.1), wallMat);\r\n    wallBack.position.set(0, ROOM_HEIGHT/2, -ROOM_DEPTH/2);\r\n    scene.add(wallBack);\r\n    // 前墙（有门）\r\n    const wallFront = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH-2, ROOM_HEIGHT, 0.1), wallMat);\r\n    wallFront.position.set(0, ROOM_HEIGHT/2, ROOM_DEPTH/2);\r\n    scene.add(wallFront);\r\n    // 左右墙（有窗）\r\n    const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\r\n    wallLeft.position.set(-ROOM_WIDTH/2, ROOM_HEIGHT/2, 0);\r\n    scene.add(wallLeft);\r\n    const wallRight = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\r\n    wallRight.position.set(ROOM_WIDTH/2, ROOM_HEIGHT/2, 0);\r\n    scene.add(wallRight);\r\n    // 门\r\n    const doorGeo = new THREE.BoxGeometry(1, 2, 0.12);\r\n    const doorMat = new THREE.MeshPhongMaterial({ color: 0x8d5524 });\r\n    const door = new THREE.Mesh(doorGeo, doorMat);\r\n    door.position.set(0, 1, ROOM_DEPTH/2+0.06);\r\n    scene.add(door);\r\n    // 窗\r\n    const windowGeo = new THREE.BoxGeometry(0.1, 1, 2);\r\n    const windowMat = new THREE.MeshPhongMaterial({ color: 0x87ceeb, transparent: true, opacity: 0.5 });\r\n    const window1 = new THREE.Mesh(windowGeo, windowMat);\r\n    window1.position.set(-ROOM_WIDTH/2-0.06, 2, 0);\r\n    scene.add(window1);\r\n    const window2 = new THREE.Mesh(windowGeo, windowMat);\r\n    window2.position.set(ROOM_WIDTH/2+0.06, 2, 0);\r\n    scene.add(window2);\r\n\r\n    // 添加书架\r\n    const bookshelfMat = new THREE.MeshPhongMaterial({ color: 0x8B4513 });\r\n    for (let row = 0; row < BOOKSHELF_CONFIG.rows; row++) {\r\n      for (let col = 0; col < BOOKSHELF_CONFIG.cols; col++) {\r\n        const bookshelf = new THREE.Mesh(\r\n          new THREE.BoxGeometry(BOOKSHELF_CONFIG.width, BOOKSHELF_CONFIG.height, BOOKSHELF_CONFIG.depth),\r\n          bookshelfMat\r\n        );\r\n        bookshelf.position.set(\r\n          (col - (BOOKSHELF_CONFIG.cols-1)/2) * (BOOKSHELF_CONFIG.width + BOOKSHELF_CONFIG.gap),\r\n          BOOKSHELF_CONFIG.height/2,\r\n          -ROOM_DEPTH/2 + 0.5 + row * (BOOKSHELF_CONFIG.depth + 0.3)\r\n        );\r\n        bookshelf.userData = {\r\n          type: 'bookshelf',\r\n          id: `bookshelf-${row+1}-${col+1}`,\r\n          info: {\r\n            name: `书架 ${row+1}-${col+1}`,\r\n            capacity: '约200本书',\r\n            category: '综合类'\r\n          }\r\n        };\r\n        scene.add(bookshelf);\r\n      }\r\n    }\r\n\r\n    // 添加讲台/服务台\r\n    const counterMat = new THREE.MeshPhongMaterial({ color: 0x4B0082 });\r\n    const counter = new THREE.Mesh(\r\n      new THREE.BoxGeometry(COUNTER_CONFIG.width, COUNTER_CONFIG.height, COUNTER_CONFIG.depth),\r\n      counterMat\r\n    );\r\n    counter.position.set(0, COUNTER_CONFIG.height/2, ROOM_DEPTH/2 - 1);\r\n    counter.userData = {\r\n      type: 'counter',\r\n      id: 'service-counter',\r\n      info: {\r\n        name: '服务台',\r\n        description: '提供咨询、借还书等服务',\r\n        staff: '2名工作人员'\r\n      }\r\n    };\r\n    scene.add(counter);\r\n\r\n    // 桌椅和座位\r\n    for (let row = 0; row < ROWS; row++) {\r\n      // 桌子\r\n      const tableGeo = new THREE.BoxGeometry(TABLE_WIDTH, 0.1, TABLE_DEPTH);\r\n      const tableMat = new THREE.MeshPhongMaterial({ color: 0xf5deb3 });\r\n      const table = new THREE.Mesh(tableGeo, tableMat);\r\n      table.position.set(0, 0.5, (row - (ROWS-1)/2) * 2);\r\n      scene.add(table);\r\n      // 座位\r\n      for (let col = 0; col < COLS; col++) {\r\n        // 椅子\r\n        const chairGeo = new THREE.CylinderGeometry(SEAT_SIZE/2, SEAT_SIZE/2, 0.18, 16);\r\n        const chairMat = new THREE.MeshPhongMaterial({ color: 0x444444 });\r\n        const chair = new THREE.Mesh(chairGeo, chairMat);\r\n        chair.position.set(\r\n          (col - (COLS-1)/2) * SEAT_GAP,\r\n          0.09,\r\n          (row - (ROWS-1)/2) * 2 - TABLE_DEPTH/2 - 0.3\r\n        );\r\n        scene.add(chair);\r\n        // 座位（可变色）\r\n        const seatGeo = new THREE.SphereGeometry(SEAT_SIZE/2, 16, 16);\r\n        const seatMat = new THREE.MeshPhongMaterial({ color: STATUS_COLOR.available });\r\n        const seat = new THREE.Mesh(seatGeo, seatMat);\r\n        seat.position.set(\r\n          (col - (COLS-1)/2) * SEAT_GAP,\r\n          0.25,\r\n          (row - (ROWS-1)/2) * 2 - TABLE_DEPTH/2 - 0.3\r\n        );\r\n        seat.userData = {\r\n          type: 'seat',\r\n          id: `seat-${row+1}-${col+1}`,\r\n          status: 'available',\r\n          info: {\r\n            name: `座位 ${row+1}-${col+1}`,\r\n            type: '普通座位',\r\n            hasPower: true,\r\n            hasComputer: false\r\n          }\r\n        };\r\n        scene.add(seat);\r\n        seatMeshMap.current[seat.userData.id] = seat;\r\n      }\r\n    }\r\n\r\n    // 添加场景标签\r\n    const labelDiv = document.createElement('div');\r\n    labelDiv.style.position = 'absolute';\r\n    labelDiv.style.pointerEvents = 'none';\r\n    labelDiv.style.color = 'white';\r\n    labelDiv.style.fontSize = '14px';\r\n    labelDiv.style.fontFamily = 'Arial';\r\n    labelDiv.style.textShadow = '1px 1px 1px black';\r\n    mountRef.current.appendChild(labelDiv);\r\n\r\n    // 创建标签位置映射\r\n    const labelPositions = new Map();\r\n    function updateLabelPosition(object, label) {\r\n      const vector = object.position.clone();\r\n      vector.project(camera);\r\n      const x = (vector.x * 0.5 + 0.5) * window.innerWidth;\r\n      const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;\r\n      label.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;\r\n    }\r\n\r\n    // 为每个物体添加标签\r\n    function addLabel(object) {\r\n      if (object.userData && object.userData.info) {\r\n        const label = document.createElement('div');\r\n        label.textContent = object.userData.info.name;\r\n        label.style.opacity = '0';\r\n        label.style.transition = 'opacity 0.3s';\r\n        labelDiv.appendChild(label);\r\n        labelPositions.set(object, label);\r\n      }\r\n    }\r\n\r\n    // 交互：鼠标悬停和点击\r\n    const raycaster = new THREE.Raycaster();\r\n    const mouse = new THREE.Vector2();\r\n    const originalMaterials = new Map();\r\n\r\n    function onMouseMove(event) {\r\n      // 计算鼠标在归一化设备坐标中的位置\r\n      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n\r\n      // 更新射线\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 获取射线与物体的交点\r\n      const intersects = raycaster.intersectObjects(scene.children);\r\n\r\n      // 重置之前高亮的物体\r\n      if (hoveredObject) {\r\n        const originalMaterial = originalMaterials.get(hoveredObject);\r\n        if (originalMaterial) {\r\n          hoveredObject.material = originalMaterial;\r\n        }\r\n        setHoveredObject(null);\r\n      }\r\n\r\n      // 高亮当前悬停的物体\r\n      if (intersects.length > 0) {\r\n        const object = intersects[0].object;\r\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\r\n          if (!originalMaterials.has(object)) {\r\n            originalMaterials.set(object, object.material.clone());\r\n          }\r\n          const highlightMaterial = object.material.clone();\r\n          highlightMaterial.emissive = new THREE.Color(0x666666);\r\n          object.material = highlightMaterial;\r\n          setHoveredObject(object);\r\n        }\r\n      }\r\n    }\r\n\r\n    function onClick(event) {\r\n      // 计算鼠标在归一化设备坐标中的位置\r\n      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n\r\n      // 更新射线\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 获取射线与物体的交点\r\n      const intersects = raycaster.intersectObjects(scene.children);\r\n\r\n      if (intersects.length > 0) {\r\n        const object = intersects[0].object;\r\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\r\n          setSelectedObject(object.userData);\r\n        }\r\n      } else {\r\n        setSelectedObject(null);\r\n      }\r\n    }\r\n\r\n    // 添加事件监听器\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('click', onClick);\r\n\r\n    // 更新标签可见性\r\n    function updateLabels() {\r\n      labelPositions.forEach((label, object) => {\r\n        const vector = object.position.clone();\r\n        vector.project(camera);\r\n        if (vector.z < 1) {\r\n          updateLabelPosition(object, label);\r\n          label.style.opacity = '1';\r\n        } else {\r\n          label.style.opacity = '0';\r\n        }\r\n      });\r\n    }\r\n\r\n    // 添加动画效果\r\n    function animateObjects() {\r\n      scene.children.forEach(object => {\r\n        if (object.userData && object.userData.type) {\r\n          // 添加轻微的浮动动画\r\n          object.position.y += Math.sin(Date.now() * 0.001 + object.position.x) * 0.0001;\r\n        }\r\n      });\r\n    }\r\n\r\n    // 添加阴影\r\n    renderer.shadowMap.enabled = true;\r\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n\r\n    // 创建小地图\r\n    const miniMapCamera = new THREE.OrthographicCamera(\r\n      -ROOM_WIDTH/2, ROOM_WIDTH/2,\r\n      ROOM_DEPTH/2, -ROOM_DEPTH/2,\r\n      0.1, 1000\r\n    );\r\n    miniMapCamera.position.set(0, ROOM_HEIGHT * 2, 0);\r\n    miniMapCamera.lookAt(0, 0, 0);\r\n\r\n    const miniMapRenderer = new THREE.WebGLRenderer({ antialias: true });\r\n    miniMapRenderer.setSize(200, 200);\r\n    miniMapRenderer.shadowMap.enabled = true;\r\n    miniMapRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n\r\n    const miniMapDiv = document.createElement('div');\r\n    miniMapDiv.style.position = 'absolute';\r\n    miniMapDiv.style.bottom = '20px';\r\n    miniMapDiv.style.right = '20px';\r\n    miniMapDiv.style.width = '200px';\r\n    miniMapDiv.style.height = '200px';\r\n    miniMapDiv.style.border = '2px solid white';\r\n    miniMapDiv.style.borderRadius = '4px';\r\n    miniMapDiv.style.overflow = 'hidden';\r\n    miniMapDiv.appendChild(miniMapRenderer.domElement);\r\n    mountRef.current.appendChild(miniMapDiv);\r\n\r\n    // 相机动画\r\n    function animate() {\r\n      requestAnimationFrame(animate);\r\n      controls.update();\r\n      animateObjects();\r\n      updateLabels();\r\n      renderer.render(scene, camera);\r\n      \r\n      // 更新小地图\r\n      if (showMiniMap) {\r\n        miniMapRenderer.render(scene, miniMapCamera);\r\n      }\r\n    }\r\n    animate();\r\n\r\n    // 添加物体状态变化动画\r\n    function animateObjectState(object, newState) {\r\n      if (!object.userData) return;\r\n      \r\n      const originalScale = object.scale.clone();\r\n      const targetScale = originalScale.clone().multiplyScalar(1.2);\r\n      \r\n      // 缩放动画\r\n      const scaleAnimation = new TWEEN.Tween(object.scale)\r\n        .to({ x: targetScale.x, y: targetScale.y, z: targetScale.z }, 200)\r\n        .easing(TWEEN.Easing.Quadratic.Out)\r\n        .yoyo(true)\r\n        .repeat(1);\r\n      \r\n      // 颜色变化动画\r\n      if (object.material) {\r\n        const originalColor = object.material.color.clone();\r\n        const targetColor = new THREE.Color(STATUS_COLOR[newState] || '#ffffff');\r\n        \r\n        const colorAnimation = new TWEEN.Tween(object.material.color)\r\n          .to({ r: targetColor.r, g: targetColor.g, b: targetColor.b }, 400)\r\n          .easing(TWEEN.Easing.Quadratic.InOut);\r\n        \r\n        colorAnimation.start();\r\n      }\r\n      \r\n      scaleAnimation.start();\r\n    }\r\n\r\n    cameraRef.current = camera;\r\n\r\n    // 修改清理函数\r\n    return () => {\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('click', onClick);\r\n      window.removeEventListener('resize', onWindowResize);\r\n      mountRef.current.removeChild(renderer.domElement);\r\n      mountRef.current.removeChild(labelDiv);\r\n      mountRef.current.removeChild(miniMapDiv);\r\n      controls.dispose();\r\n    };\r\n  }, []);\r\n\r\n  // 处理视角切换\r\n  const handleViewChange = (view) => {\r\n    const preset = CAMERA_PRESETS[view];\r\n    if (preset) {\r\n      animateCamera(preset.position, preset.lookAt);\r\n    }\r\n  };\r\n\r\n  // 处理搜索\r\n  const handleSearch = (query) => {\r\n    setSearchQuery(query);\r\n    // 实现搜索逻辑\r\n  };\r\n\r\n  // 处理分类筛选\r\n  const handleCategoryChange = (category) => {\r\n    setSelectedCategory(category);\r\n    // 实现分类筛选逻辑\r\n  };\r\n\r\n  return (\r\n    <div style={{ position: 'relative' }}>\r\n      <div ref={mountRef} style={{ width: '100%', height: '100vh' }} />\r\n      \r\n      {/* 控制面板 */}\r\n      <div style={{\r\n        position: 'absolute',\r\n        top: '20px',\r\n        right: '20px',\r\n        background: 'rgba(255, 255, 255, 0.9)',\r\n        padding: '20px',\r\n        borderRadius: '8px',\r\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        gap: '10px'\r\n      }}>\r\n        {/* 视角控制 */}\r\n        <div>\r\n          <h4 style={{ margin: '0 0 10px 0' }}>视角控制</h4>\r\n          <div style={{ display: 'flex', gap: '5px' }}>\r\n            <button onClick={() => handleViewChange('top')}>俯视图</button>\r\n            <button onClick={() => handleViewChange('front')}>前视图</button>\r\n            <button onClick={() => handleViewChange('side')}>侧视图</button>\r\n            <button onClick={() => handleViewChange('default')}>默认视角</button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 搜索框 */}\r\n        <div>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"搜索...\"\r\n            value={searchQuery}\r\n            onChange={(e) => handleSearch(e.target.value)}\r\n            style={{\r\n              padding: '8px',\r\n              borderRadius: '4px',\r\n              border: '1px solid #ccc',\r\n              width: '100%'\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        {/* 分类筛选 */}\r\n        <div>\r\n          <select\r\n            value={selectedCategory}\r\n            onChange={(e) => handleCategoryChange(e.target.value)}\r\n            style={{\r\n              padding: '8px',\r\n              borderRadius: '4px',\r\n              border: '1px solid #ccc',\r\n              width: '100%'\r\n            }}\r\n          >\r\n            <option value=\"all\">所有</option>\r\n            <option value=\"seat\">座位</option>\r\n            <option value=\"bookshelf\">书架</option>\r\n            <option value=\"counter\">服务台</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* 小地图控制 */}\r\n        <div>\r\n          <label>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={showMiniMap}\r\n              onChange={(e) => setShowMiniMap(e.target.checked)}\r\n            />\r\n            显示小地图\r\n          </label>\r\n        </div>\r\n\r\n        {/* 视角模式切换 */}\r\n        <button\r\n          onClick={() => setCameraMode(mode => mode === 'orbit' ? 'fixed' : 'orbit')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            border: 'none',\r\n            borderRadius: '4px',\r\n            background: '#4CAF50',\r\n            color: 'white',\r\n            cursor: 'pointer'\r\n          }}\r\n        >\r\n          {cameraMode === 'orbit' ? '固定视角' : '自由视角'}\r\n        </button>\r\n\r\n        {/* 场景状态控制 */}\r\n        <div style={{ display: 'flex', gap: '10px' }}>\r\n          <button\r\n            onClick={saveSceneState}\r\n            style={{\r\n              padding: '8px 16px',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              background: '#2196F3',\r\n              color: 'white',\r\n              cursor: 'pointer',\r\n              flex: 1\r\n            }}\r\n          >\r\n            保存场景\r\n          </button>\r\n          <label\r\n            style={{\r\n              padding: '8px 16px',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              background: '#FF9800',\r\n              color: 'white',\r\n              cursor: 'pointer',\r\n              textAlign: 'center',\r\n              flex: 1\r\n            }}\r\n          >\r\n            加载场景\r\n            <input\r\n              type=\"file\"\r\n              accept=\".json\"\r\n              onChange={loadSceneState}\r\n              style={{ display: 'none' }}\r\n            />\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 信息弹窗 */}\r\n      {selectedObject && (\r\n        <div style={{\r\n          position: 'absolute',\r\n          top: '20px',\r\n          left: '20px',\r\n          background: 'rgba(255, 255, 255, 0.9)',\r\n          padding: '20px',\r\n          borderRadius: '8px',\r\n          boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\r\n          maxWidth: '300px'\r\n        }}>\r\n          <h3>{selectedObject.info.name}</h3>\r\n          {Object.entries(selectedObject.info).map(([key, value]) => (\r\n            key !== 'name' && (\r\n              <p key={key}>\r\n                <strong>{key}: </strong>\r\n                {value}\r\n              </p>\r\n            )\r\n          ))}\r\n          <button\r\n            onClick={() => setSelectedObject(null)}\r\n            style={{\r\n              position: 'absolute',\r\n              top: '10px',\r\n              right: '10px',\r\n              background: 'none',\r\n              border: 'none',\r\n              fontSize: '20px',\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}