{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u5565\\u90FD\\u884C\\\\\\u667A\\u6167\\u56FE\\u4E66\\u9986\\\\smart_library\\\\frontend\\\\src\\\\components\\\\ThreeScene.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { fadeTransition } from '../threejs/fadeTransition';\nimport { saveAs } from 'file-saver';\nimport * as TWEEN from '@tweenjs/tween.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WS_URL = 'ws://localhost:8080';\nconst ROWS = 5;\nconst COLS = 10;\nconst SEAT_SIZE = 0.4;\nconst SEAT_GAP = 0.6;\nconst TABLE_WIDTH = COLS * SEAT_GAP;\nconst TABLE_DEPTH = 0.5;\nconst ROOM_WIDTH = COLS * SEAT_GAP + 2;\nconst ROOM_DEPTH = ROWS * 2 + 2;\nconst ROOM_HEIGHT = 3;\n\n// 书架配置\nconst BOOKSHELF_CONFIG = {\n  width: 1.2,\n  depth: 0.4,\n  height: 2.2,\n  gap: 0.8,\n  rows: 2,\n  cols: 4\n};\n\n// 讲台/服务台配置\nconst COUNTER_CONFIG = {\n  width: 3,\n  depth: 0.8,\n  height: 1.1\n};\nconst STATUS_COLOR = {\n  available: '#00ff00',\n  // 绿色\n  occupied: '#ff0000',\n  // 红色\n  reserved: '#ffd600',\n  // 黄色\n  broken: '#888888' // 灰色\n};\n\n// 预设视角配置\nconst CAMERA_PRESETS = {\n  top: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT * 2, 0),\n    lookAt: new THREE.Vector3(0, 0, 0)\n  },\n  front: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT / 2, ROOM_DEPTH * 1.5),\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT / 2, 0)\n  },\n  side: {\n    position: new THREE.Vector3(ROOM_WIDTH * 1.5, ROOM_HEIGHT / 2, 0),\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT / 2, 0)\n  },\n  default: {\n    position: new THREE.Vector3(0, ROOM_HEIGHT, ROOM_DEPTH / 2 + 2),\n    lookAt: new THREE.Vector3(0, 0, 0)\n  }\n};\n\n// 在 useEffect 外部添加以下函数，确保全局可用\nfunction onWindowResize() {\n  // 这里假设 camera 和 renderer 是全局变量或通过 ref 获取\n  // 你可以根据实际情况调整\n  if (window.camera && window.renderer) {\n    window.camera.aspect = window.innerWidth / window.innerHeight;\n    window.camera.updateProjectionMatrix();\n    window.renderer.setSize(window.innerWidth, window.innerHeight);\n  }\n}\nexport default function ThreeScene() {\n  _s();\n  const mountRef = useRef();\n  const seatMeshMap = useRef({});\n  const sceneRef = useRef();\n  const transitionRef = useRef();\n  const [selectedObject, setSelectedObject] = useState(null);\n  const [hoveredObject, setHoveredObject] = useState(null);\n  const [cameraMode, setCameraMode] = useState('orbit');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [showMiniMap, setShowMiniMap] = useState(true);\n  const [sceneState, setSceneState] = useState(null);\n  useEffect(() => {\n    // 场景、相机、渲染器\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0x22232a);\n    sceneRef.current = scene;\n    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);\n    camera.position.set(0, ROOM_HEIGHT, ROOM_DEPTH / 2 + 2);\n    camera.lookAt(0, 0, 0);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    mountRef.current.appendChild(renderer.domElement);\n    transitionRef.current = fadeTransition(renderer);\n\n    // 添加轨道控制器\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controls.screenSpacePanning = false;\n    controls.minDistance = 3;\n    controls.maxDistance = 20;\n    controls.maxPolarAngle = Math.PI / 2;\n\n    // 灯光\n    const ambient = new THREE.AmbientLight(0xffffff, 0.4);\n    scene.add(ambient);\n    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);\n    dirLight.position.set(5, 10, 5);\n    dirLight.castShadow = true;\n    dirLight.shadow.mapSize.width = 2048;\n    dirLight.shadow.mapSize.height = 2048;\n    dirLight.shadow.camera.near = 0.5;\n    dirLight.shadow.camera.far = 50;\n    dirLight.shadow.camera.left = -10;\n    dirLight.shadow.camera.right = 10;\n    dirLight.shadow.camera.top = 10;\n    dirLight.shadow.camera.bottom = -10;\n    scene.add(dirLight);\n\n    // 为所有物体启用阴影\n    scene.traverse(object => {\n      if (object.isMesh) {\n        object.castShadow = true;\n        object.receiveShadow = true;\n      }\n    });\n\n    // 地板\n    const floorGeo = new THREE.BoxGeometry(ROOM_WIDTH, 0.1, ROOM_DEPTH);\n    const floorMat = new THREE.MeshPhongMaterial({\n      color: 0xcccccc\n    });\n    const floor = new THREE.Mesh(floorGeo, floorMat);\n    floor.position.set(0, -0.05, 0);\n    scene.add(floor);\n\n    // 墙壁\n    const wallMat = new THREE.MeshPhongMaterial({\n      color: 0xeeeeee,\n      side: THREE.DoubleSide\n    });\n    // 后墙\n    const wallBack = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH, ROOM_HEIGHT, 0.1), wallMat);\n    wallBack.position.set(0, ROOM_HEIGHT / 2, -ROOM_DEPTH / 2);\n    scene.add(wallBack);\n    // 前墙（有门）\n    const wallFront = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH - 2, ROOM_HEIGHT, 0.1), wallMat);\n    wallFront.position.set(0, ROOM_HEIGHT / 2, ROOM_DEPTH / 2);\n    scene.add(wallFront);\n    // 左右墙（有窗）\n    const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\n    wallLeft.position.set(-ROOM_WIDTH / 2, ROOM_HEIGHT / 2, 0);\n    scene.add(wallLeft);\n    const wallRight = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\n    wallRight.position.set(ROOM_WIDTH / 2, ROOM_HEIGHT / 2, 0);\n    scene.add(wallRight);\n    // 门\n    const doorGeo = new THREE.BoxGeometry(1, 2, 0.12);\n    const doorMat = new THREE.MeshPhongMaterial({\n      color: 0x8d5524\n    });\n    const door = new THREE.Mesh(doorGeo, doorMat);\n    door.position.set(0, 1, ROOM_DEPTH / 2 + 0.06);\n    scene.add(door);\n    // 窗\n    const windowGeo = new THREE.BoxGeometry(0.1, 1, 2);\n    const windowMat = new THREE.MeshPhongMaterial({\n      color: 0x87ceeb,\n      transparent: true,\n      opacity: 0.5\n    });\n    const window1 = new THREE.Mesh(windowGeo, windowMat);\n    window1.position.set(-ROOM_WIDTH / 2 - 0.06, 2, 0);\n    scene.add(window1);\n    const window2 = new THREE.Mesh(windowGeo, windowMat);\n    window2.position.set(ROOM_WIDTH / 2 + 0.06, 2, 0);\n    scene.add(window2);\n\n    // 添加书架\n    const bookshelfMat = new THREE.MeshPhongMaterial({\n      color: 0x8B4513\n    });\n    for (let row = 0; row < BOOKSHELF_CONFIG.rows; row++) {\n      for (let col = 0; col < BOOKSHELF_CONFIG.cols; col++) {\n        const bookshelf = new THREE.Mesh(new THREE.BoxGeometry(BOOKSHELF_CONFIG.width, BOOKSHELF_CONFIG.height, BOOKSHELF_CONFIG.depth), bookshelfMat);\n        bookshelf.position.set((col - (BOOKSHELF_CONFIG.cols - 1) / 2) * (BOOKSHELF_CONFIG.width + BOOKSHELF_CONFIG.gap), BOOKSHELF_CONFIG.height / 2, -ROOM_DEPTH / 2 + 0.5 + row * (BOOKSHELF_CONFIG.depth + 0.3));\n        bookshelf.userData = {\n          type: 'bookshelf',\n          id: `bookshelf-${row + 1}-${col + 1}`,\n          info: {\n            name: `书架 ${row + 1}-${col + 1}`,\n            capacity: '约200本书',\n            category: '综合类'\n          }\n        };\n        scene.add(bookshelf);\n      }\n    }\n\n    // 添加讲台/服务台\n    const counterMat = new THREE.MeshPhongMaterial({\n      color: 0x4B0082\n    });\n    const counter = new THREE.Mesh(new THREE.BoxGeometry(COUNTER_CONFIG.width, COUNTER_CONFIG.height, COUNTER_CONFIG.depth), counterMat);\n    counter.position.set(0, COUNTER_CONFIG.height / 2, ROOM_DEPTH / 2 - 1);\n    counter.userData = {\n      type: 'counter',\n      id: 'service-counter',\n      info: {\n        name: '服务台',\n        description: '提供咨询、借还书等服务',\n        staff: '2名工作人员'\n      }\n    };\n    scene.add(counter);\n\n    // 桌椅和座位\n    for (let row = 0; row < ROWS; row++) {\n      // 桌子\n      const tableGeo = new THREE.BoxGeometry(TABLE_WIDTH, 0.1, TABLE_DEPTH);\n      const tableMat = new THREE.MeshPhongMaterial({\n        color: 0xf5deb3\n      });\n      const table = new THREE.Mesh(tableGeo, tableMat);\n      table.position.set(0, 0.5, (row - (ROWS - 1) / 2) * 2);\n      scene.add(table);\n      // 座位\n      for (let col = 0; col < COLS; col++) {\n        // 椅子\n        const chairGeo = new THREE.CylinderGeometry(SEAT_SIZE / 2, SEAT_SIZE / 2, 0.18, 16);\n        const chairMat = new THREE.MeshPhongMaterial({\n          color: 0x444444\n        });\n        const chair = new THREE.Mesh(chairGeo, chairMat);\n        chair.position.set((col - (COLS - 1) / 2) * SEAT_GAP, 0.09, (row - (ROWS - 1) / 2) * 2 - TABLE_DEPTH / 2 - 0.3);\n        scene.add(chair);\n        // 座位（可变色）\n        const seatGeo = new THREE.SphereGeometry(SEAT_SIZE / 2, 16, 16);\n        const seatMat = new THREE.MeshPhongMaterial({\n          color: STATUS_COLOR.available\n        });\n        const seat = new THREE.Mesh(seatGeo, seatMat);\n        seat.position.set((col - (COLS - 1) / 2) * SEAT_GAP, 0.25, (row - (ROWS - 1) / 2) * 2 - TABLE_DEPTH / 2 - 0.3);\n        seat.userData = {\n          type: 'seat',\n          id: `seat-${row + 1}-${col + 1}`,\n          status: 'available',\n          info: {\n            name: `座位 ${row + 1}-${col + 1}`,\n            type: '普通座位',\n            hasPower: true,\n            hasComputer: false\n          }\n        };\n        scene.add(seat);\n        seatMeshMap.current[seat.userData.id] = seat;\n      }\n    }\n\n    // 添加场景标签\n    const labelDiv = document.createElement('div');\n    labelDiv.style.position = 'absolute';\n    labelDiv.style.pointerEvents = 'none';\n    labelDiv.style.color = 'white';\n    labelDiv.style.fontSize = '14px';\n    labelDiv.style.fontFamily = 'Arial';\n    labelDiv.style.textShadow = '1px 1px 1px black';\n    mountRef.current.appendChild(labelDiv);\n\n    // 创建标签位置映射\n    const labelPositions = new Map();\n    function updateLabelPosition(object, label) {\n      const vector = object.position.clone();\n      vector.project(camera);\n      const x = (vector.x * 0.5 + 0.5) * window.innerWidth;\n      const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;\n      label.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;\n    }\n\n    // 为每个物体添加标签\n    function addLabel(object) {\n      if (object.userData && object.userData.info) {\n        const label = document.createElement('div');\n        label.textContent = object.userData.info.name;\n        label.style.opacity = '0';\n        label.style.transition = 'opacity 0.3s';\n        labelDiv.appendChild(label);\n        labelPositions.set(object, label);\n      }\n    }\n\n    // 交互：鼠标悬停和点击\n    const raycaster = new THREE.Raycaster();\n    const mouse = new THREE.Vector2();\n    const originalMaterials = new Map();\n    function onMouseMove(event) {\n      // 计算鼠标在归一化设备坐标中的位置\n      mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n      // 更新射线\n      raycaster.setFromCamera(mouse, camera);\n\n      // 获取射线与物体的交点\n      const intersects = raycaster.intersectObjects(scene.children);\n\n      // 重置之前高亮的物体\n      if (hoveredObject) {\n        const originalMaterial = originalMaterials.get(hoveredObject);\n        if (originalMaterial) {\n          hoveredObject.material = originalMaterial;\n        }\n        setHoveredObject(null);\n      }\n\n      // 高亮当前悬停的物体\n      if (intersects.length > 0) {\n        const object = intersects[0].object;\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\n          if (!originalMaterials.has(object)) {\n            originalMaterials.set(object, object.material.clone());\n          }\n          const highlightMaterial = object.material.clone();\n          highlightMaterial.emissive = new THREE.Color(0x666666);\n          object.material = highlightMaterial;\n          setHoveredObject(object);\n        }\n      }\n    }\n    function onClick(event) {\n      // 计算鼠标在归一化设备坐标中的位置\n      mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n      // 更新射线\n      raycaster.setFromCamera(mouse, camera);\n\n      // 获取射线与物体的交点\n      const intersects = raycaster.intersectObjects(scene.children);\n      if (intersects.length > 0) {\n        const object = intersects[0].object;\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\n          setSelectedObject(object.userData);\n        }\n      } else {\n        setSelectedObject(null);\n      }\n    }\n\n    // 添加事件监听器\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('click', onClick);\n\n    // 更新标签可见性\n    function updateLabels() {\n      labelPositions.forEach((label, object) => {\n        const vector = object.position.clone();\n        vector.project(camera);\n        if (vector.z < 1) {\n          updateLabelPosition(object, label);\n          label.style.opacity = '1';\n        } else {\n          label.style.opacity = '0';\n        }\n      });\n    }\n\n    // 添加动画效果\n    function animateObjects() {\n      scene.children.forEach(object => {\n        if (object.userData && object.userData.type) {\n          // 添加轻微的浮动动画\n          object.position.y += Math.sin(Date.now() * 0.001 + object.position.x) * 0.0001;\n        }\n      });\n    }\n\n    // 添加阴影\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\n    // 创建小地图\n    const miniMapCamera = new THREE.OrthographicCamera(-ROOM_WIDTH / 2, ROOM_WIDTH / 2, ROOM_DEPTH / 2, -ROOM_DEPTH / 2, 0.1, 1000);\n    miniMapCamera.position.set(0, ROOM_HEIGHT * 2, 0);\n    miniMapCamera.lookAt(0, 0, 0);\n    const miniMapRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    miniMapRenderer.setSize(200, 200);\n    miniMapRenderer.shadowMap.enabled = true;\n    miniMapRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n    const miniMapDiv = document.createElement('div');\n    miniMapDiv.style.position = 'absolute';\n    miniMapDiv.style.bottom = '20px';\n    miniMapDiv.style.right = '20px';\n    miniMapDiv.style.width = '200px';\n    miniMapDiv.style.height = '200px';\n    miniMapDiv.style.border = '2px solid white';\n    miniMapDiv.style.borderRadius = '4px';\n    miniMapDiv.style.overflow = 'hidden';\n    miniMapDiv.appendChild(miniMapRenderer.domElement);\n    mountRef.current.appendChild(miniMapDiv);\n\n    // 相机动画\n    function animateCamera(targetPosition, targetLookAt, duration = 1000) {\n      const startPosition = camera.position.clone();\n      const startLookAt = new THREE.Vector3();\n      camera.getWorldDirection(startLookAt);\n      startLookAt.multiplyScalar(10).add(camera.position);\n      const startTime = Date.now();\n      function updateCamera() {\n        const elapsed = Date.now() - startTime;\n        const progress = Math.min(elapsed / duration, 1);\n\n        // 使用缓动函数使动画更平滑\n        const easeProgress = 1 - Math.pow(1 - progress, 3);\n        camera.position.lerpVectors(startPosition, targetPosition, easeProgress);\n        const currentLookAt = new THREE.Vector3();\n        currentLookAt.lerpVectors(startLookAt, targetLookAt, easeProgress);\n        camera.lookAt(currentLookAt);\n        if (progress < 1) {\n          requestAnimationFrame(updateCamera);\n        }\n      }\n      updateCamera();\n    }\n\n    // 修改动画循环\n    function animate() {\n      requestAnimationFrame(animate);\n      controls.update();\n      animateObjects();\n      updateLabels();\n      renderer.render(scene, camera);\n\n      // 更新小地图\n      if (showMiniMap) {\n        miniMapRenderer.render(scene, miniMapCamera);\n      }\n    }\n    animate();\n\n    // 添加物体状态变化动画\n    function animateObjectState(object, newState) {\n      if (!object.userData) return;\n      const originalScale = object.scale.clone();\n      const targetScale = originalScale.clone().multiplyScalar(1.2);\n\n      // 缩放动画\n      const scaleAnimation = new TWEEN.Tween(object.scale).to({\n        x: targetScale.x,\n        y: targetScale.y,\n        z: targetScale.z\n      }, 200).easing(TWEEN.Easing.Quadratic.Out).yoyo(true).repeat(1);\n\n      // 颜色变化动画\n      if (object.material) {\n        const originalColor = object.material.color.clone();\n        const targetColor = new THREE.Color(STATUS_COLOR[newState] || '#ffffff');\n        const colorAnimation = new TWEEN.Tween(object.material.color).to({\n          r: targetColor.r,\n          g: targetColor.g,\n          b: targetColor.b\n        }, 400).easing(TWEEN.Easing.Quadratic.InOut);\n        colorAnimation.start();\n      }\n      scaleAnimation.start();\n    }\n\n    // 保存场景状态\n    const saveSceneState = () => {\n      const state = {\n        camera: {\n          position: camera.position.toArray(),\n          lookAt: new THREE.Vector3().subVectors(camera.position, new THREE.Vector3().setFromMatrixColumn(camera.matrix, 2)).toArray()\n        },\n        objects: scene.children.filter(obj => obj.userData && obj.userData.type).map(obj => ({\n          id: obj.userData.id,\n          type: obj.userData.type,\n          position: obj.position.toArray(),\n          rotation: obj.rotation.toArray(),\n          scale: obj.scale.toArray(),\n          status: obj.userData.status,\n          info: obj.userData.info\n        }))\n      };\n      const blob = new Blob([JSON.stringify(state, null, 2)], {\n        type: 'application/json'\n      });\n      saveAs(blob, 'library-scene.json');\n    };\n\n    // 加载场景状态\n    const loadSceneState = event => {\n      const file = event.target.files[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = e => {\n          try {\n            const state = JSON.parse(e.target.result);\n\n            // 恢复相机位置\n            if (state.camera) {\n              const {\n                position,\n                lookAt\n              } = state.camera;\n              animateCamera(new THREE.Vector3(...position), new THREE.Vector3(...lookAt));\n            }\n\n            // 恢复物体状态\n            state.objects.forEach(objState => {\n              const obj = scene.children.find(child => child.userData && child.userData.id === objState.id);\n              if (obj) {\n                obj.position.fromArray(objState.position);\n                obj.rotation.fromArray(objState.rotation);\n                obj.scale.fromArray(objState.scale);\n                obj.userData.status = objState.status;\n                obj.userData.info = objState.info;\n\n                // 更新材质颜色\n                if (obj.material && objState.status) {\n                  obj.material.color.set(STATUS_COLOR[objState.status]);\n                }\n              }\n            });\n            setSceneState(state);\n          } catch (error) {\n            console.error('Error loading scene state:', error);\n            alert('加载场景状态失败');\n          }\n        };\n        reader.readAsText(file);\n      }\n    };\n\n    // 修改清理函数\n    return () => {\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('click', onClick);\n      window.removeEventListener('resize', onWindowResize);\n      mountRef.current.removeChild(renderer.domElement);\n      mountRef.current.removeChild(labelDiv);\n      mountRef.current.removeChild(miniMapDiv);\n      controls.dispose();\n    };\n  }, []);\n\n  // 处理视角切换\n  const handleViewChange = view => {\n    const preset = CAMERA_PRESETS[view];\n    if (preset) {\n      animateCamera(preset.position, preset.lookAt);\n    }\n  };\n\n  // 处理搜索\n  const handleSearch = query => {\n    setSearchQuery(query);\n    // 实现搜索逻辑\n  };\n\n  // 处理分类筛选\n  const handleCategoryChange = category => {\n    setSelectedCategory(category);\n    // 实现分类筛选逻辑\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mountRef,\n      style: {\n        width: '100%',\n        height: '100vh'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '20px',\n        right: '20px',\n        background: 'rgba(255, 255, 255, 0.9)',\n        padding: '20px',\n        borderRadius: '8px',\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '10px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: '0 0 10px 0'\n          },\n          children: \"\\u89C6\\u89D2\\u63A7\\u5236\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '5px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('top'),\n            children: \"\\u4FEF\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 614,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('front'),\n            children: \"\\u524D\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('side'),\n            children: \"\\u4FA7\\u89C6\\u56FE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 616,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleViewChange('default'),\n            children: \"\\u9ED8\\u8BA4\\u89C6\\u89D2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 617,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 613,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 611,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"\\u641C\\u7D22...\",\n          value: searchQuery,\n          onChange: e => handleSearch(e.target.value),\n          style: {\n            padding: '8px',\n            borderRadius: '4px',\n            border: '1px solid #ccc',\n            width: '100%'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 623,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedCategory,\n          onChange: e => handleCategoryChange(e.target.value),\n          style: {\n            padding: '8px',\n            borderRadius: '4px',\n            border: '1px solid #ccc',\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"all\",\n            children: \"\\u6240\\u6709\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"seat\",\n            children: \"\\u5EA7\\u4F4D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 650,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"bookshelf\",\n            children: \"\\u4E66\\u67B6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 651,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"counter\",\n            children: \"\\u670D\\u52A1\\u53F0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 639,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 638,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"label\", {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            checked: showMiniMap,\n            onChange: e => setShowMiniMap(e.target.checked)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 659,\n            columnNumber: 13\n          }, this), \"\\u663E\\u793A\\u5C0F\\u5730\\u56FE\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 658,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 657,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setCameraMode(mode => mode === 'orbit' ? 'fixed' : 'orbit'),\n        style: {\n          padding: '8px 16px',\n          border: 'none',\n          borderRadius: '4px',\n          background: '#4CAF50',\n          color: 'white',\n          cursor: 'pointer'\n        },\n        children: cameraMode === 'orbit' ? '固定视角' : '自由视角'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 669,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '10px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: saveSceneState,\n          style: {\n            padding: '8px 16px',\n            border: 'none',\n            borderRadius: '4px',\n            background: '#2196F3',\n            color: 'white',\n            cursor: 'pointer',\n            flex: 1\n          },\n          children: \"\\u4FDD\\u5B58\\u573A\\u666F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 685,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            padding: '8px 16px',\n            border: 'none',\n            borderRadius: '4px',\n            background: '#FF9800',\n            color: 'white',\n            cursor: 'pointer',\n            textAlign: 'center',\n            flex: 1\n          },\n          children: [\"\\u52A0\\u8F7D\\u573A\\u666F\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \".json\",\n            onChange: loadSceneState,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 712,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 684,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 7\n    }, this), selectedObject && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '20px',\n        left: '20px',\n        background: 'rgba(255, 255, 255, 0.9)',\n        padding: '20px',\n        borderRadius: '8px',\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\n        maxWidth: '300px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: selectedObject.info.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 734,\n        columnNumber: 11\n      }, this), Object.entries(selectedObject.info).map(([key, value]) => key !== 'name' && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [key, \": \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 738,\n          columnNumber: 17\n        }, this), value]\n      }, key, true, {\n        fileName: _jsxFileName,\n        lineNumber: 737,\n        columnNumber: 15\n      }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setSelectedObject(null),\n        style: {\n          position: 'absolute',\n          top: '10px',\n          right: '10px',\n          background: 'none',\n          border: 'none',\n          fontSize: '20px',\n          cursor: 'pointer'\n        },\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 743,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 724,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 594,\n    columnNumber: 5\n  }, this);\n}\n_s(ThreeScene, \"R0+d2pZiHeNyG4b+oubhhVmzshY=\");\n_c = ThreeScene;\nvar _c;\n$RefreshReg$(_c, \"ThreeScene\");","map":{"version":3,"names":["React","useEffect","useRef","useState","THREE","OrbitControls","fadeTransition","saveAs","TWEEN","jsxDEV","_jsxDEV","WS_URL","ROWS","COLS","SEAT_SIZE","SEAT_GAP","TABLE_WIDTH","TABLE_DEPTH","ROOM_WIDTH","ROOM_DEPTH","ROOM_HEIGHT","BOOKSHELF_CONFIG","width","depth","height","gap","rows","cols","COUNTER_CONFIG","STATUS_COLOR","available","occupied","reserved","broken","CAMERA_PRESETS","top","position","Vector3","lookAt","front","side","default","onWindowResize","window","camera","renderer","aspect","innerWidth","innerHeight","updateProjectionMatrix","setSize","ThreeScene","_s","mountRef","seatMeshMap","sceneRef","transitionRef","selectedObject","setSelectedObject","hoveredObject","setHoveredObject","cameraMode","setCameraMode","searchQuery","setSearchQuery","selectedCategory","setSelectedCategory","showMiniMap","setShowMiniMap","sceneState","setSceneState","scene","Scene","background","Color","current","PerspectiveCamera","set","WebGLRenderer","antialias","appendChild","domElement","controls","enableDamping","dampingFactor","screenSpacePanning","minDistance","maxDistance","maxPolarAngle","Math","PI","ambient","AmbientLight","add","dirLight","DirectionalLight","castShadow","shadow","mapSize","near","far","left","right","bottom","traverse","object","isMesh","receiveShadow","floorGeo","BoxGeometry","floorMat","MeshPhongMaterial","color","floor","Mesh","wallMat","DoubleSide","wallBack","wallFront","wallLeft","wallRight","doorGeo","doorMat","door","windowGeo","windowMat","transparent","opacity","window1","window2","bookshelfMat","row","col","bookshelf","userData","type","id","info","name","capacity","category","counterMat","counter","description","staff","tableGeo","tableMat","table","chairGeo","CylinderGeometry","chairMat","chair","seatGeo","SphereGeometry","seatMat","seat","status","hasPower","hasComputer","labelDiv","document","createElement","style","pointerEvents","fontSize","fontFamily","textShadow","labelPositions","Map","updateLabelPosition","label","vector","clone","project","x","y","transform","addLabel","textContent","transition","raycaster","Raycaster","mouse","Vector2","originalMaterials","onMouseMove","event","clientX","clientY","setFromCamera","intersects","intersectObjects","children","originalMaterial","get","material","length","has","highlightMaterial","emissive","onClick","addEventListener","updateLabels","forEach","z","animateObjects","sin","Date","now","shadowMap","enabled","PCFSoftShadowMap","miniMapCamera","OrthographicCamera","miniMapRenderer","miniMapDiv","border","borderRadius","overflow","animateCamera","targetPosition","targetLookAt","duration","startPosition","startLookAt","getWorldDirection","multiplyScalar","startTime","updateCamera","elapsed","progress","min","easeProgress","pow","lerpVectors","currentLookAt","requestAnimationFrame","animate","update","render","animateObjectState","newState","originalScale","scale","targetScale","scaleAnimation","Tween","to","easing","Easing","Quadratic","Out","yoyo","repeat","originalColor","targetColor","colorAnimation","r","g","b","InOut","start","saveSceneState","state","toArray","subVectors","setFromMatrixColumn","matrix","objects","filter","obj","map","rotation","blob","Blob","JSON","stringify","loadSceneState","file","target","files","reader","FileReader","onload","e","parse","result","objState","find","child","fromArray","error","console","alert","readAsText","removeEventListener","removeChild","dispose","handleViewChange","view","preset","handleSearch","query","handleCategoryChange","ref","fileName","_jsxFileName","lineNumber","columnNumber","padding","boxShadow","display","flexDirection","margin","placeholder","value","onChange","checked","mode","cursor","flex","textAlign","accept","maxWidth","Object","entries","key","_c","$RefreshReg$"],"sources":["D:/啥都行/智慧图书馆/smart_library/frontend/src/components/ThreeScene.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { fadeTransition } from '../threejs/fadeTransition';\r\nimport { saveAs } from 'file-saver';\r\nimport * as TWEEN from '@tweenjs/tween.js';\r\n\r\nconst WS_URL = 'ws://localhost:8080';\r\nconst ROWS = 5;\r\nconst COLS = 10;\r\nconst SEAT_SIZE = 0.4;\r\nconst SEAT_GAP = 0.6;\r\nconst TABLE_WIDTH = COLS * SEAT_GAP;\r\nconst TABLE_DEPTH = 0.5;\r\nconst ROOM_WIDTH = COLS * SEAT_GAP + 2;\r\nconst ROOM_DEPTH = ROWS * 2 + 2;\r\nconst ROOM_HEIGHT = 3;\r\n\r\n// 书架配置\r\nconst BOOKSHELF_CONFIG = {\r\n  width: 1.2,\r\n  depth: 0.4,\r\n  height: 2.2,\r\n  gap: 0.8,\r\n  rows: 2,\r\n  cols: 4\r\n};\r\n\r\n// 讲台/服务台配置\r\nconst COUNTER_CONFIG = {\r\n  width: 3,\r\n  depth: 0.8,\r\n  height: 1.1\r\n};\r\n\r\nconst STATUS_COLOR = {\r\n  available: '#00ff00', // 绿色\r\n  occupied: '#ff0000', // 红色\r\n  reserved: '#ffd600', // 黄色\r\n  broken: '#888888'    // 灰色\r\n};\r\n\r\n// 预设视角配置\r\nconst CAMERA_PRESETS = {\r\n  top: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT * 2, 0),\r\n    lookAt: new THREE.Vector3(0, 0, 0)\r\n  },\r\n  front: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT/2, ROOM_DEPTH * 1.5),\r\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT/2, 0)\r\n  },\r\n  side: {\r\n    position: new THREE.Vector3(ROOM_WIDTH * 1.5, ROOM_HEIGHT/2, 0),\r\n    lookAt: new THREE.Vector3(0, ROOM_HEIGHT/2, 0)\r\n  },\r\n  default: {\r\n    position: new THREE.Vector3(0, ROOM_HEIGHT, ROOM_DEPTH/2 + 2),\r\n    lookAt: new THREE.Vector3(0, 0, 0)\r\n  }\r\n};\r\n\r\n// 在 useEffect 外部添加以下函数，确保全局可用\r\nfunction onWindowResize() {\r\n  // 这里假设 camera 和 renderer 是全局变量或通过 ref 获取\r\n  // 你可以根据实际情况调整\r\n  if (window.camera && window.renderer) {\r\n    window.camera.aspect = window.innerWidth / window.innerHeight;\r\n    window.camera.updateProjectionMatrix();\r\n    window.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n}\r\n\r\nexport default function ThreeScene() {\r\n  const mountRef = useRef();\r\n  const seatMeshMap = useRef({});\r\n  const sceneRef = useRef();\r\n  const transitionRef = useRef();\r\n  const [selectedObject, setSelectedObject] = useState(null);\r\n  const [hoveredObject, setHoveredObject] = useState(null);\r\n  const [cameraMode, setCameraMode] = useState('orbit');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState('all');\r\n  const [showMiniMap, setShowMiniMap] = useState(true);\r\n  const [sceneState, setSceneState] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // 场景、相机、渲染器\r\n    const scene = new THREE.Scene();\r\n    scene.background = new THREE.Color(0x22232a);\r\n    sceneRef.current = scene;\r\n    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);\r\n    camera.position.set(0, ROOM_HEIGHT, ROOM_DEPTH/2 + 2);\r\n    camera.lookAt(0, 0, 0);\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n    mountRef.current.appendChild(renderer.domElement);\r\n    transitionRef.current = fadeTransition(renderer);\r\n\r\n    // 添加轨道控制器\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.screenSpacePanning = false;\r\n    controls.minDistance = 3;\r\n    controls.maxDistance = 20;\r\n    controls.maxPolarAngle = Math.PI / 2;\r\n\r\n    // 灯光\r\n    const ambient = new THREE.AmbientLight(0xffffff, 0.4);\r\n    scene.add(ambient);\r\n    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);\r\n    dirLight.position.set(5, 10, 5);\r\n    dirLight.castShadow = true;\r\n    dirLight.shadow.mapSize.width = 2048;\r\n    dirLight.shadow.mapSize.height = 2048;\r\n    dirLight.shadow.camera.near = 0.5;\r\n    dirLight.shadow.camera.far = 50;\r\n    dirLight.shadow.camera.left = -10;\r\n    dirLight.shadow.camera.right = 10;\r\n    dirLight.shadow.camera.top = 10;\r\n    dirLight.shadow.camera.bottom = -10;\r\n    scene.add(dirLight);\r\n\r\n    // 为所有物体启用阴影\r\n    scene.traverse((object) => {\r\n      if (object.isMesh) {\r\n        object.castShadow = true;\r\n        object.receiveShadow = true;\r\n      }\r\n    });\r\n\r\n    // 地板\r\n    const floorGeo = new THREE.BoxGeometry(ROOM_WIDTH, 0.1, ROOM_DEPTH);\r\n    const floorMat = new THREE.MeshPhongMaterial({ color: 0xcccccc });\r\n    const floor = new THREE.Mesh(floorGeo, floorMat);\r\n    floor.position.set(0, -0.05, 0);\r\n    scene.add(floor);\r\n\r\n    // 墙壁\r\n    const wallMat = new THREE.MeshPhongMaterial({ color: 0xeeeeee, side: THREE.DoubleSide });\r\n    // 后墙\r\n    const wallBack = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH, ROOM_HEIGHT, 0.1), wallMat);\r\n    wallBack.position.set(0, ROOM_HEIGHT/2, -ROOM_DEPTH/2);\r\n    scene.add(wallBack);\r\n    // 前墙（有门）\r\n    const wallFront = new THREE.Mesh(new THREE.BoxGeometry(ROOM_WIDTH-2, ROOM_HEIGHT, 0.1), wallMat);\r\n    wallFront.position.set(0, ROOM_HEIGHT/2, ROOM_DEPTH/2);\r\n    scene.add(wallFront);\r\n    // 左右墙（有窗）\r\n    const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\r\n    wallLeft.position.set(-ROOM_WIDTH/2, ROOM_HEIGHT/2, 0);\r\n    scene.add(wallLeft);\r\n    const wallRight = new THREE.Mesh(new THREE.BoxGeometry(0.1, ROOM_HEIGHT, ROOM_DEPTH), wallMat);\r\n    wallRight.position.set(ROOM_WIDTH/2, ROOM_HEIGHT/2, 0);\r\n    scene.add(wallRight);\r\n    // 门\r\n    const doorGeo = new THREE.BoxGeometry(1, 2, 0.12);\r\n    const doorMat = new THREE.MeshPhongMaterial({ color: 0x8d5524 });\r\n    const door = new THREE.Mesh(doorGeo, doorMat);\r\n    door.position.set(0, 1, ROOM_DEPTH/2+0.06);\r\n    scene.add(door);\r\n    // 窗\r\n    const windowGeo = new THREE.BoxGeometry(0.1, 1, 2);\r\n    const windowMat = new THREE.MeshPhongMaterial({ color: 0x87ceeb, transparent: true, opacity: 0.5 });\r\n    const window1 = new THREE.Mesh(windowGeo, windowMat);\r\n    window1.position.set(-ROOM_WIDTH/2-0.06, 2, 0);\r\n    scene.add(window1);\r\n    const window2 = new THREE.Mesh(windowGeo, windowMat);\r\n    window2.position.set(ROOM_WIDTH/2+0.06, 2, 0);\r\n    scene.add(window2);\r\n\r\n    // 添加书架\r\n    const bookshelfMat = new THREE.MeshPhongMaterial({ color: 0x8B4513 });\r\n    for (let row = 0; row < BOOKSHELF_CONFIG.rows; row++) {\r\n      for (let col = 0; col < BOOKSHELF_CONFIG.cols; col++) {\r\n        const bookshelf = new THREE.Mesh(\r\n          new THREE.BoxGeometry(BOOKSHELF_CONFIG.width, BOOKSHELF_CONFIG.height, BOOKSHELF_CONFIG.depth),\r\n          bookshelfMat\r\n        );\r\n        bookshelf.position.set(\r\n          (col - (BOOKSHELF_CONFIG.cols-1)/2) * (BOOKSHELF_CONFIG.width + BOOKSHELF_CONFIG.gap),\r\n          BOOKSHELF_CONFIG.height/2,\r\n          -ROOM_DEPTH/2 + 0.5 + row * (BOOKSHELF_CONFIG.depth + 0.3)\r\n        );\r\n        bookshelf.userData = {\r\n          type: 'bookshelf',\r\n          id: `bookshelf-${row+1}-${col+1}`,\r\n          info: {\r\n            name: `书架 ${row+1}-${col+1}`,\r\n            capacity: '约200本书',\r\n            category: '综合类'\r\n          }\r\n        };\r\n        scene.add(bookshelf);\r\n      }\r\n    }\r\n\r\n    // 添加讲台/服务台\r\n    const counterMat = new THREE.MeshPhongMaterial({ color: 0x4B0082 });\r\n    const counter = new THREE.Mesh(\r\n      new THREE.BoxGeometry(COUNTER_CONFIG.width, COUNTER_CONFIG.height, COUNTER_CONFIG.depth),\r\n      counterMat\r\n    );\r\n    counter.position.set(0, COUNTER_CONFIG.height/2, ROOM_DEPTH/2 - 1);\r\n    counter.userData = {\r\n      type: 'counter',\r\n      id: 'service-counter',\r\n      info: {\r\n        name: '服务台',\r\n        description: '提供咨询、借还书等服务',\r\n        staff: '2名工作人员'\r\n      }\r\n    };\r\n    scene.add(counter);\r\n\r\n    // 桌椅和座位\r\n    for (let row = 0; row < ROWS; row++) {\r\n      // 桌子\r\n      const tableGeo = new THREE.BoxGeometry(TABLE_WIDTH, 0.1, TABLE_DEPTH);\r\n      const tableMat = new THREE.MeshPhongMaterial({ color: 0xf5deb3 });\r\n      const table = new THREE.Mesh(tableGeo, tableMat);\r\n      table.position.set(0, 0.5, (row - (ROWS-1)/2) * 2);\r\n      scene.add(table);\r\n      // 座位\r\n      for (let col = 0; col < COLS; col++) {\r\n        // 椅子\r\n        const chairGeo = new THREE.CylinderGeometry(SEAT_SIZE/2, SEAT_SIZE/2, 0.18, 16);\r\n        const chairMat = new THREE.MeshPhongMaterial({ color: 0x444444 });\r\n        const chair = new THREE.Mesh(chairGeo, chairMat);\r\n        chair.position.set(\r\n          (col - (COLS-1)/2) * SEAT_GAP,\r\n          0.09,\r\n          (row - (ROWS-1)/2) * 2 - TABLE_DEPTH/2 - 0.3\r\n        );\r\n        scene.add(chair);\r\n        // 座位（可变色）\r\n        const seatGeo = new THREE.SphereGeometry(SEAT_SIZE/2, 16, 16);\r\n        const seatMat = new THREE.MeshPhongMaterial({ color: STATUS_COLOR.available });\r\n        const seat = new THREE.Mesh(seatGeo, seatMat);\r\n        seat.position.set(\r\n          (col - (COLS-1)/2) * SEAT_GAP,\r\n          0.25,\r\n          (row - (ROWS-1)/2) * 2 - TABLE_DEPTH/2 - 0.3\r\n        );\r\n        seat.userData = {\r\n          type: 'seat',\r\n          id: `seat-${row+1}-${col+1}`,\r\n          status: 'available',\r\n          info: {\r\n            name: `座位 ${row+1}-${col+1}`,\r\n            type: '普通座位',\r\n            hasPower: true,\r\n            hasComputer: false\r\n          }\r\n        };\r\n        scene.add(seat);\r\n        seatMeshMap.current[seat.userData.id] = seat;\r\n      }\r\n    }\r\n\r\n    // 添加场景标签\r\n    const labelDiv = document.createElement('div');\r\n    labelDiv.style.position = 'absolute';\r\n    labelDiv.style.pointerEvents = 'none';\r\n    labelDiv.style.color = 'white';\r\n    labelDiv.style.fontSize = '14px';\r\n    labelDiv.style.fontFamily = 'Arial';\r\n    labelDiv.style.textShadow = '1px 1px 1px black';\r\n    mountRef.current.appendChild(labelDiv);\r\n\r\n    // 创建标签位置映射\r\n    const labelPositions = new Map();\r\n    function updateLabelPosition(object, label) {\r\n      const vector = object.position.clone();\r\n      vector.project(camera);\r\n      const x = (vector.x * 0.5 + 0.5) * window.innerWidth;\r\n      const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;\r\n      label.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;\r\n    }\r\n\r\n    // 为每个物体添加标签\r\n    function addLabel(object) {\r\n      if (object.userData && object.userData.info) {\r\n        const label = document.createElement('div');\r\n        label.textContent = object.userData.info.name;\r\n        label.style.opacity = '0';\r\n        label.style.transition = 'opacity 0.3s';\r\n        labelDiv.appendChild(label);\r\n        labelPositions.set(object, label);\r\n      }\r\n    }\r\n\r\n    // 交互：鼠标悬停和点击\r\n    const raycaster = new THREE.Raycaster();\r\n    const mouse = new THREE.Vector2();\r\n    const originalMaterials = new Map();\r\n\r\n    function onMouseMove(event) {\r\n      // 计算鼠标在归一化设备坐标中的位置\r\n      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n\r\n      // 更新射线\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 获取射线与物体的交点\r\n      const intersects = raycaster.intersectObjects(scene.children);\r\n\r\n      // 重置之前高亮的物体\r\n      if (hoveredObject) {\r\n        const originalMaterial = originalMaterials.get(hoveredObject);\r\n        if (originalMaterial) {\r\n          hoveredObject.material = originalMaterial;\r\n        }\r\n        setHoveredObject(null);\r\n      }\r\n\r\n      // 高亮当前悬停的物体\r\n      if (intersects.length > 0) {\r\n        const object = intersects[0].object;\r\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\r\n          if (!originalMaterials.has(object)) {\r\n            originalMaterials.set(object, object.material.clone());\r\n          }\r\n          const highlightMaterial = object.material.clone();\r\n          highlightMaterial.emissive = new THREE.Color(0x666666);\r\n          object.material = highlightMaterial;\r\n          setHoveredObject(object);\r\n        }\r\n      }\r\n    }\r\n\r\n    function onClick(event) {\r\n      // 计算鼠标在归一化设备坐标中的位置\r\n      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n\r\n      // 更新射线\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 获取射线与物体的交点\r\n      const intersects = raycaster.intersectObjects(scene.children);\r\n\r\n      if (intersects.length > 0) {\r\n        const object = intersects[0].object;\r\n        if (object.userData && (object.userData.type === 'seat' || object.userData.type === 'bookshelf' || object.userData.type === 'counter')) {\r\n          setSelectedObject(object.userData);\r\n        }\r\n      } else {\r\n        setSelectedObject(null);\r\n      }\r\n    }\r\n\r\n    // 添加事件监听器\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('click', onClick);\r\n\r\n    // 更新标签可见性\r\n    function updateLabels() {\r\n      labelPositions.forEach((label, object) => {\r\n        const vector = object.position.clone();\r\n        vector.project(camera);\r\n        if (vector.z < 1) {\r\n          updateLabelPosition(object, label);\r\n          label.style.opacity = '1';\r\n        } else {\r\n          label.style.opacity = '0';\r\n        }\r\n      });\r\n    }\r\n\r\n    // 添加动画效果\r\n    function animateObjects() {\r\n      scene.children.forEach(object => {\r\n        if (object.userData && object.userData.type) {\r\n          // 添加轻微的浮动动画\r\n          object.position.y += Math.sin(Date.now() * 0.001 + object.position.x) * 0.0001;\r\n        }\r\n      });\r\n    }\r\n\r\n    // 添加阴影\r\n    renderer.shadowMap.enabled = true;\r\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n\r\n    // 创建小地图\r\n    const miniMapCamera = new THREE.OrthographicCamera(\r\n      -ROOM_WIDTH/2, ROOM_WIDTH/2,\r\n      ROOM_DEPTH/2, -ROOM_DEPTH/2,\r\n      0.1, 1000\r\n    );\r\n    miniMapCamera.position.set(0, ROOM_HEIGHT * 2, 0);\r\n    miniMapCamera.lookAt(0, 0, 0);\r\n\r\n    const miniMapRenderer = new THREE.WebGLRenderer({ antialias: true });\r\n    miniMapRenderer.setSize(200, 200);\r\n    miniMapRenderer.shadowMap.enabled = true;\r\n    miniMapRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n\r\n    const miniMapDiv = document.createElement('div');\r\n    miniMapDiv.style.position = 'absolute';\r\n    miniMapDiv.style.bottom = '20px';\r\n    miniMapDiv.style.right = '20px';\r\n    miniMapDiv.style.width = '200px';\r\n    miniMapDiv.style.height = '200px';\r\n    miniMapDiv.style.border = '2px solid white';\r\n    miniMapDiv.style.borderRadius = '4px';\r\n    miniMapDiv.style.overflow = 'hidden';\r\n    miniMapDiv.appendChild(miniMapRenderer.domElement);\r\n    mountRef.current.appendChild(miniMapDiv);\r\n\r\n    // 相机动画\r\n    function animateCamera(targetPosition, targetLookAt, duration = 1000) {\r\n      const startPosition = camera.position.clone();\r\n      const startLookAt = new THREE.Vector3();\r\n      camera.getWorldDirection(startLookAt);\r\n      startLookAt.multiplyScalar(10).add(camera.position);\r\n\r\n      const startTime = Date.now();\r\n      \r\n      function updateCamera() {\r\n        const elapsed = Date.now() - startTime;\r\n        const progress = Math.min(elapsed / duration, 1);\r\n        \r\n        // 使用缓动函数使动画更平滑\r\n        const easeProgress = 1 - Math.pow(1 - progress, 3);\r\n        \r\n        camera.position.lerpVectors(startPosition, targetPosition, easeProgress);\r\n        \r\n        const currentLookAt = new THREE.Vector3();\r\n        currentLookAt.lerpVectors(startLookAt, targetLookAt, easeProgress);\r\n        camera.lookAt(currentLookAt);\r\n        \r\n        if (progress < 1) {\r\n          requestAnimationFrame(updateCamera);\r\n        }\r\n      }\r\n      \r\n      updateCamera();\r\n    }\r\n\r\n    // 修改动画循环\r\n    function animate() {\r\n      requestAnimationFrame(animate);\r\n      controls.update();\r\n      animateObjects();\r\n      updateLabels();\r\n      renderer.render(scene, camera);\r\n      \r\n      // 更新小地图\r\n      if (showMiniMap) {\r\n        miniMapRenderer.render(scene, miniMapCamera);\r\n      }\r\n    }\r\n    animate();\r\n\r\n    // 添加物体状态变化动画\r\n    function animateObjectState(object, newState) {\r\n      if (!object.userData) return;\r\n      \r\n      const originalScale = object.scale.clone();\r\n      const targetScale = originalScale.clone().multiplyScalar(1.2);\r\n      \r\n      // 缩放动画\r\n      const scaleAnimation = new TWEEN.Tween(object.scale)\r\n        .to({ x: targetScale.x, y: targetScale.y, z: targetScale.z }, 200)\r\n        .easing(TWEEN.Easing.Quadratic.Out)\r\n        .yoyo(true)\r\n        .repeat(1);\r\n      \r\n      // 颜色变化动画\r\n      if (object.material) {\r\n        const originalColor = object.material.color.clone();\r\n        const targetColor = new THREE.Color(STATUS_COLOR[newState] || '#ffffff');\r\n        \r\n        const colorAnimation = new TWEEN.Tween(object.material.color)\r\n          .to({ r: targetColor.r, g: targetColor.g, b: targetColor.b }, 400)\r\n          .easing(TWEEN.Easing.Quadratic.InOut);\r\n        \r\n        colorAnimation.start();\r\n      }\r\n      \r\n      scaleAnimation.start();\r\n    }\r\n\r\n    // 保存场景状态\r\n    const saveSceneState = () => {\r\n      const state = {\r\n        camera: {\r\n          position: camera.position.toArray(),\r\n          lookAt: new THREE.Vector3().subVectors(\r\n            camera.position,\r\n            new THREE.Vector3().setFromMatrixColumn(camera.matrix, 2)\r\n          ).toArray()\r\n        },\r\n        objects: scene.children\r\n          .filter(obj => obj.userData && obj.userData.type)\r\n          .map(obj => ({\r\n            id: obj.userData.id,\r\n            type: obj.userData.type,\r\n            position: obj.position.toArray(),\r\n            rotation: obj.rotation.toArray(),\r\n            scale: obj.scale.toArray(),\r\n            status: obj.userData.status,\r\n            info: obj.userData.info\r\n          }))\r\n      };\r\n\r\n      const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });\r\n      saveAs(blob, 'library-scene.json');\r\n    };\r\n\r\n    // 加载场景状态\r\n    const loadSceneState = (event) => {\r\n      const file = event.target.files[0];\r\n      if (file) {\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n          try {\r\n            const state = JSON.parse(e.target.result);\r\n            \r\n            // 恢复相机位置\r\n            if (state.camera) {\r\n              const { position, lookAt } = state.camera;\r\n              animateCamera(\r\n                new THREE.Vector3(...position),\r\n                new THREE.Vector3(...lookAt)\r\n              );\r\n            }\r\n\r\n            // 恢复物体状态\r\n            state.objects.forEach(objState => {\r\n              const obj = scene.children.find(\r\n                child => child.userData && child.userData.id === objState.id\r\n              );\r\n              if (obj) {\r\n                obj.position.fromArray(objState.position);\r\n                obj.rotation.fromArray(objState.rotation);\r\n                obj.scale.fromArray(objState.scale);\r\n                obj.userData.status = objState.status;\r\n                obj.userData.info = objState.info;\r\n                \r\n                // 更新材质颜色\r\n                if (obj.material && objState.status) {\r\n                  obj.material.color.set(STATUS_COLOR[objState.status]);\r\n                }\r\n              }\r\n            });\r\n\r\n            setSceneState(state);\r\n          } catch (error) {\r\n            console.error('Error loading scene state:', error);\r\n            alert('加载场景状态失败');\r\n          }\r\n        };\r\n        reader.readAsText(file);\r\n      }\r\n    };\r\n\r\n    // 修改清理函数\r\n    return () => {\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('click', onClick);\r\n      window.removeEventListener('resize', onWindowResize);\r\n      mountRef.current.removeChild(renderer.domElement);\r\n      mountRef.current.removeChild(labelDiv);\r\n      mountRef.current.removeChild(miniMapDiv);\r\n      controls.dispose();\r\n    };\r\n  }, []);\r\n\r\n  // 处理视角切换\r\n  const handleViewChange = (view) => {\r\n    const preset = CAMERA_PRESETS[view];\r\n    if (preset) {\r\n      animateCamera(preset.position, preset.lookAt);\r\n    }\r\n  };\r\n\r\n  // 处理搜索\r\n  const handleSearch = (query) => {\r\n    setSearchQuery(query);\r\n    // 实现搜索逻辑\r\n  };\r\n\r\n  // 处理分类筛选\r\n  const handleCategoryChange = (category) => {\r\n    setSelectedCategory(category);\r\n    // 实现分类筛选逻辑\r\n  };\r\n\r\n  return (\r\n    <div style={{ position: 'relative' }}>\r\n      <div ref={mountRef} style={{ width: '100%', height: '100vh' }} />\r\n      \r\n      {/* 控制面板 */}\r\n      <div style={{\r\n        position: 'absolute',\r\n        top: '20px',\r\n        right: '20px',\r\n        background: 'rgba(255, 255, 255, 0.9)',\r\n        padding: '20px',\r\n        borderRadius: '8px',\r\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        gap: '10px'\r\n      }}>\r\n        {/* 视角控制 */}\r\n        <div>\r\n          <h4 style={{ margin: '0 0 10px 0' }}>视角控制</h4>\r\n          <div style={{ display: 'flex', gap: '5px' }}>\r\n            <button onClick={() => handleViewChange('top')}>俯视图</button>\r\n            <button onClick={() => handleViewChange('front')}>前视图</button>\r\n            <button onClick={() => handleViewChange('side')}>侧视图</button>\r\n            <button onClick={() => handleViewChange('default')}>默认视角</button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 搜索框 */}\r\n        <div>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"搜索...\"\r\n            value={searchQuery}\r\n            onChange={(e) => handleSearch(e.target.value)}\r\n            style={{\r\n              padding: '8px',\r\n              borderRadius: '4px',\r\n              border: '1px solid #ccc',\r\n              width: '100%'\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        {/* 分类筛选 */}\r\n        <div>\r\n          <select\r\n            value={selectedCategory}\r\n            onChange={(e) => handleCategoryChange(e.target.value)}\r\n            style={{\r\n              padding: '8px',\r\n              borderRadius: '4px',\r\n              border: '1px solid #ccc',\r\n              width: '100%'\r\n            }}\r\n          >\r\n            <option value=\"all\">所有</option>\r\n            <option value=\"seat\">座位</option>\r\n            <option value=\"bookshelf\">书架</option>\r\n            <option value=\"counter\">服务台</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* 小地图控制 */}\r\n        <div>\r\n          <label>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={showMiniMap}\r\n              onChange={(e) => setShowMiniMap(e.target.checked)}\r\n            />\r\n            显示小地图\r\n          </label>\r\n        </div>\r\n\r\n        {/* 视角模式切换 */}\r\n        <button\r\n          onClick={() => setCameraMode(mode => mode === 'orbit' ? 'fixed' : 'orbit')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            border: 'none',\r\n            borderRadius: '4px',\r\n            background: '#4CAF50',\r\n            color: 'white',\r\n            cursor: 'pointer'\r\n          }}\r\n        >\r\n          {cameraMode === 'orbit' ? '固定视角' : '自由视角'}\r\n        </button>\r\n\r\n        {/* 场景状态控制 */}\r\n        <div style={{ display: 'flex', gap: '10px' }}>\r\n          <button\r\n            onClick={saveSceneState}\r\n            style={{\r\n              padding: '8px 16px',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              background: '#2196F3',\r\n              color: 'white',\r\n              cursor: 'pointer',\r\n              flex: 1\r\n            }}\r\n          >\r\n            保存场景\r\n          </button>\r\n          <label\r\n            style={{\r\n              padding: '8px 16px',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              background: '#FF9800',\r\n              color: 'white',\r\n              cursor: 'pointer',\r\n              textAlign: 'center',\r\n              flex: 1\r\n            }}\r\n          >\r\n            加载场景\r\n            <input\r\n              type=\"file\"\r\n              accept=\".json\"\r\n              onChange={loadSceneState}\r\n              style={{ display: 'none' }}\r\n            />\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 信息弹窗 */}\r\n      {selectedObject && (\r\n        <div style={{\r\n          position: 'absolute',\r\n          top: '20px',\r\n          left: '20px',\r\n          background: 'rgba(255, 255, 255, 0.9)',\r\n          padding: '20px',\r\n          borderRadius: '8px',\r\n          boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\r\n          maxWidth: '300px'\r\n        }}>\r\n          <h3>{selectedObject.info.name}</h3>\r\n          {Object.entries(selectedObject.info).map(([key, value]) => (\r\n            key !== 'name' && (\r\n              <p key={key}>\r\n                <strong>{key}: </strong>\r\n                {value}\r\n              </p>\r\n            )\r\n          ))}\r\n          <button\r\n            onClick={() => setSelectedObject(null)}\r\n            style={{\r\n              position: 'absolute',\r\n              top: '10px',\r\n              right: '10px',\r\n              background: 'none',\r\n              border: 'none',\r\n              fontSize: '20px',\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}